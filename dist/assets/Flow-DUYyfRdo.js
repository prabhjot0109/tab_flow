import"./modulepreload-polyfill-B5Qt9EMX.js";let c=[],A=[],B=[],o=0,T="grid",l="active",d="",s=[],u=!1,i,r,q,D,C,W,U,R;async function _(){console.log("[FLOW POPUP] Initializing..."),i=document.getElementById("tab-flow-grid"),r=document.querySelector(".tab-flow-search"),q=document.querySelector('[data-view="grid"]'),D=document.querySelector('[data-view="list"]'),C=document.querySelector(".tab-flow-section-title"),W=document.querySelector(".search-tab-hint"),U=document.querySelector(".tab-flow-help"),R=document.querySelector(".tab-flow-container"),document.querySelector(".tab-flow-backdrop")?.addEventListener("click",()=>window.close());try{(await chrome.storage.local.get(["TabFlowViewMode"])).TabFlowViewMode==="list"&&(T="list",q.classList.remove("active"),D.classList.add("active"))}catch{}try{const t=await chrome.storage.session.get(["FlowTabData"]);if(t.FlowTabData){const n=t.FlowTabData;c=n.tabs,A=[...c],B=n.groups,s=[...c];const h=c.findIndex(m=>m.active);o=h>=0?Math.min(h+1,c.length-1):0,x(),v(),I(),chrome.storage.session.remove(["FlowTabData"])}else await $()}catch(t){console.error("[FLOW POPUP] Failed to load tab data:",t),await $()}j(),setTimeout(()=>r.focus(),50)}async function $(){try{const e=await chrome.runtime.sendMessage({action:"getTabsForFlow"});if(e&&e.tabs){c=e.tabs,A=[...c],B=e.groups||[],s=[...c];const t=c.findIndex(n=>n.active);o=t>=0?Math.min(t+1,c.length-1):0,x(),v(),I()}}catch(e){console.error("[FLOW POPUP] Failed to request tabs:",e)}}function j(){r.addEventListener("input",H),r.addEventListener("keydown",J),q.addEventListener("click",()=>z("grid")),D.addEventListener("click",()=>z("list")),document.addEventListener("keydown",X),i.addEventListener("click",Y),document.addEventListener("keydown",e=>{e.key==="Escape"&&window.close()}),chrome?.runtime?.onMessage&&chrome.runtime.onMessage.addListener((e,t,n)=>e?.action==="FlowPopupCycleNext"?(E(),v(),n?.({success:!0}),!0):!1)}function H(e){const t=r.value;d=t.toLowerCase().trim();const n=d.length>0||l==="recent"||u;W.classList.toggle("hidden",n);const h=e instanceof InputEvent&&e.inputType==="deleteContentBackward";if(t==="."&&!h){r.value="",d="",l==="recent"?K():se();return}if(l!=="recent"&&u){s=[{id:-1,title:d?`Search Web for "${d}"`:"Type to search web...",url:d?`https://www.google.com/search?q=${encodeURIComponent(d)}`:"",favIconUrl:"https://www.google.com/favicon.ico",screenshot:null,pinned:!1,index:0,active:!1,isWebSearch:!0,searchQuery:d}],o=0,C.textContent="Web Search",i.classList.add("search-mode"),i.classList.remove("recent-mode"),R.classList.add("shrink-mode"),x(),v();return}i.classList.remove("search-mode"),R.classList.remove("shrink-mode"),C.textContent=l==="recent"?"Recently Closed":"Opened Tabs",d?(s=c.filter(m=>m.title.toLowerCase().includes(d)||m.url&&m.url.toLowerCase().includes(d)),C.textContent=`Results (${s.length})`,i.classList.add("search-mode")):(s=[...c],C.textContent=l==="recent"?"Recently Closed":"Opened Tabs",i.classList.remove("search-mode")),o=0,x(),v()}function J(e){if((e.key==="q"||e.key==="Q")&&e.altKey){e.preventDefault(),e.stopPropagation(),E();return}if(e.key==="Tab"&&!e.shiftKey){e.preventDefault(),e.stopPropagation();const t=r.value.trim();if(l==="recent")E();else if(t.length===0)u=!u,H(),I(),r.focus();else if(u&&t){const n=`https://www.google.com/search?q=${encodeURIComponent(t)}`;chrome.tabs.create({url:n}),window.close()}else{const n=`https://www.google.com/search?q=${encodeURIComponent(t)}`;chrome.tabs.create({url:n}),window.close()}}}function X(e){if((e.key==="q"||e.key==="Q")&&e.altKey){e.preventDefault(),e.stopPropagation(),E();return}if(e.key==="Tab"&&!e.shiftKey){e.preventDefault(),e.stopPropagation();const t=r.value.trim();if(l==="recent")E();else if(t.length===0)u=!u,H(),I(),r.focus();else{const n=`https://www.google.com/search?q=${encodeURIComponent(t)}`;chrome.tabs.create({url:n}),window.close()}return}if(e.key==="Tab"&&e.shiftKey){e.preventDefault(),e.stopPropagation(),O();return}if(e.key==="Backspace"&&r.value===""){if(u){u=!1,H(),I();return}if(l==="recent"){K();return}}if(!(document.activeElement===r&&!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter","Escape","Delete"].includes(e.key)))switch(e.key){case"ArrowUp":e.preventDefault(),O();break;case"ArrowDown":e.preventDefault(),E();break;case"ArrowLeft":e.preventDefault(),T==="grid"&&!d&&!u&&l!=="recent"?ee():O();break;case"ArrowRight":e.preventDefault(),T==="grid"&&!d&&!u&&l!=="recent"?te():E();break;case"Enter":e.preventDefault(),ae();break;case"Delete":l!=="recent"&&(document.activeElement!==r||r.value==="")&&(e.preventDefault(),oe());break}}function Y(e){const t=e.target,n=t.closest(".tab-card");if(!n)return;if(n.classList.contains("web-search-card")){const L=r.value.trim();if(L){const M=`https://www.google.com/search?q=${encodeURIComponent(L)}`;chrome.tabs.create({url:M}),window.close()}return}const h=n.dataset.sessionId;if(h){e.stopPropagation(),Q(h);return}const m=parseInt(n.dataset.tabId||"0",10);if(m){if(t.closest(".tab-close-btn")){e.stopPropagation(),Z(m);return}G(m)}}function E(){if(s.length!==0){if(T==="grid"&&!d){ne();const e=o+1;o=e>=s.length?0:e}else o=(o+1)%s.length;v()}}function O(){if(s.length!==0){if(T==="grid"&&!d){const e=o-1;o=e<0?s.length-1:e}else o=o<=0?s.length-1:o-1;v()}}function ee(){if(s.length===0)return;const e=o-1;o=e<0?s.length-1:e,v()}function te(){if(s.length===0)return;const e=o+1;o=e>=s.length?0:e,v()}function ne(){const e=i.clientWidth-24;return Math.max(1,Math.floor(e/(200+10)))}function ae(){if(s.length===0)return;const e=s[o];if(e){if(e.isWebSearch){e.searchQuery&&e.url&&(chrome.tabs.create({url:e.url}),window.close());return}if(e.sessionId){Q(e.sessionId);return}e.id>0&&G(e.id)}}async function G(e){try{await chrome.tabs.update(e,{active:!0});const t=await chrome.tabs.get(e);t.windowId&&await chrome.windows.update(t.windowId,{focused:!0}),window.close()}catch(t){console.error("[FLOW POPUP] Failed to switch tab:",t)}}function K(){l!=="active"&&(l="active",u=!1,c=[...A],s=[...c],o=0,i.classList.remove("recent-mode"),i.classList.remove("search-mode"),R.classList.remove("shrink-mode"),C.textContent="Opened Tabs",r.value="",d="",W.classList.remove("hidden"),x(),v(),I(),r.focus())}async function se(){if(l!=="recent"){l="recent",u=!1;try{const e=await chrome.runtime.sendMessage({action:"getRecentlyClosed",maxResults:10});e?.success&&e.items?(c=e.items.map((n,h)=>({id:-1,title:n.title||"Untitled",url:n.url||"",favIconUrl:n.favIconUrl||"",screenshot:null,pinned:!1,index:h,active:!1,sessionId:n.sessionId})),s=[...c]):(c=[],s=[])}catch(e){console.error("[FLOW POPUP] Failed to load recently closed:",e),c=[],s=[]}o=0,i.classList.add("recent-mode"),i.classList.remove("search-mode"),C.textContent="Recently Closed",r.value="",d="",W.classList.add("hidden"),x(),v(),I(),r.focus()}}async function Q(e){try{await chrome.runtime.sendMessage({action:"restoreSession",sessionId:e}),window.close()}catch(t){console.error("[FLOW POPUP] Failed to restore session:",t)}}function I(){U&&(l==="recent"?U.innerHTML=`
      <span><kbd>‚Üë‚Üì</kbd> Navigate</span>
      <span><kbd>‚Üµ</kbd>Restore</span>
      <span><kbd>.</kbd> <kbd>Backspace</kbd> Active Tabs</span>
      <span><kbd>Esc</kbd>Exit</span>
    `:u?U.innerHTML=`
      <span><kbd>Tab</kbd>Exit Search Mode</span>
      <span><kbd>‚Üµ</kbd>Search Google</span>
      <span><kbd>Backspace</kbd>Exit</span>
      <span><kbd>Esc</kbd>Exit</span>
    `:U.innerHTML=`
      <span><kbd>Alt+Q</kbd> <kbd>‚Üë‚Üì</kbd> Navigate</span>
      <span><kbd>‚Üµ</kbd>Switch</span>
      <span><kbd>Del</kbd>Close</span>
      <span><kbd>.</kbd>Recent</span>
      <span><kbd>Tab</kbd>Web Search</span>
      <span><kbd>Esc</kbd>Exit</span>
    `)}async function Z(e){try{await chrome.tabs.remove(e),c=c.filter(t=>t.id!==e),s=s.filter(t=>t.id!==e),o>=s.length&&(o=Math.max(0,s.length-1)),x(),v(),s.length===0&&window.close()}catch(t){console.error("[FLOW POPUP] Failed to close tab:",t)}}function oe(){if(s.length===0)return;const e=s[o];e&&Z(e.id)}function z(e){T=e,q.classList.toggle("active",e==="grid"),D.classList.toggle("active",e==="list"),i.classList.toggle("list-view",e==="list");try{chrome.storage.local.set({TabFlowViewMode:e})}catch{}v()}function v(){i.querySelectorAll(".tab-card.selected").forEach(t=>{t.classList.remove("selected")});const e=i.querySelectorAll(".tab-card");e[o]&&(e[o].classList.add("selected"),e[o].scrollIntoView({block:"nearest",behavior:"smooth"}))}function x(){if(i.innerHTML="",i.classList.toggle("list-view",T==="list"),s.length===0){const e=l==="recent"?"No recently closed tabs":u?"Type to search the web...":"No tabs found";i.innerHTML=`
      <div class="tab-flow-empty">
        <div class="empty-icon">${l==="recent"?"üìã":u?"üåê":"üîç"}</div>
        <div>${e}</div>
      </div>
    `;return}s.forEach((e,t)=>{const n=ce(e,t);i.appendChild(n)})}function ce(e,t){const n=document.createElement("div");if(e.isWebSearch){n.className="tab-card web-search-card",n.dataset.index=String(t);const a=document.createElement("div");a.className="tab-thumbnail";const f=document.createElement("div");f.className="favicon-tile";const g=document.createElement("img");g.className="favicon-large",g.src="https://www.google.com/favicon.ico",g.alt="Google",g.onerror=()=>{f.innerHTML='<div class="favicon-letter">G</div>'},f.appendChild(g),a.appendChild(f),n.appendChild(a);const w=document.createElement("div");w.className="tab-info";const b=document.createElement("div");b.className="tab-title-row";const y=document.createElement("img");y.className="tab-favicon",y.src="https://www.google.com/favicon.ico",y.alt="",b.appendChild(y);const p=document.createElement("span");p.className="tab-title",p.textContent=e.title,b.appendChild(p),w.appendChild(b);const k=document.createElement("div");return k.className="tab-url",k.textContent=e.searchQuery?"Press Enter to search Google":"Type your search query...",w.appendChild(k),n.appendChild(w),n}if(e.sessionId){n.className="tab-card recent-item",n.dataset.sessionId=e.sessionId,n.dataset.index=String(t);const a=document.createElement("div");if(a.className="tab-thumbnail",e.favIconUrl){const p=document.createElement("div");p.className="favicon-tile";const k=document.createElement("img");k.className="favicon-large",k.src=e.favIconUrl,k.alt="",k.onerror=()=>{p.innerHTML=`<div class="favicon-letter">${F(e.title)}</div>`},p.appendChild(k),a.appendChild(p)}else a.innerHTML=`<div class="favicon-tile"><div class="favicon-letter">${F(e.title)}</div></div>`;n.appendChild(a);const f=document.createElement("div");f.className="tab-info";const g=document.createElement("div");if(g.className="tab-title-row",e.favIconUrl){const p=document.createElement("img");p.className="tab-favicon",p.src=e.favIconUrl,p.alt="",p.onerror=()=>p.remove(),g.appendChild(p)}const w=document.createElement("span");w.className="tab-title",w.textContent=e.title||"Untitled",w.title=e.title||"Untitled",g.appendChild(w),f.appendChild(g);const b=document.createElement("div");b.className="tab-url",b.textContent=V(e.url),b.title=e.url||"",f.appendChild(b),n.appendChild(f);const y=document.createElement("button");return y.className="tab-close-btn restore-btn",y.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
      <path d="M3 3v5h5"/>
    </svg>`,y.title="Restore tab",n.appendChild(y),n}n.className=`tab-card${e.pinned?" pinned":""}${e.active?" active-tab":""}`,n.dataset.tabId=String(e.id),n.dataset.index=String(t);const h=e.groupId&&e.groupId!==-1?B.find(a=>a.id===e.groupId):null;h&&(n.dataset.groupId=String(h.id),n.style.setProperty("--group-color",re(h.color)));const m=document.createElement("div");if(m.className="tab-thumbnail",e.screenshot){const a=document.createElement("img");a.className="screenshot-img",a.src=e.screenshot,a.alt="",a.loading="lazy",m.appendChild(a)}else{const a=document.createElement("div");if(a.className="favicon-tile",e.favIconUrl&&!e.favIconUrl.startsWith("chrome://")){const f=document.createElement("img");f.className="favicon-large",f.src=e.favIconUrl,f.alt="",f.onerror=()=>{a.innerHTML=`<div class="favicon-letter">${F(e.title)}</div>`},a.appendChild(f)}else a.innerHTML=`<div class="favicon-letter">${F(e.title)}</div>`;m.appendChild(a)}n.appendChild(m);const L=document.createElement("div");L.className="tab-info";const M=document.createElement("div");if(M.className="tab-title-row",e.favIconUrl&&!e.favIconUrl.startsWith("chrome://")){const a=document.createElement("img");a.className="tab-favicon",a.src=e.favIconUrl,a.alt="",a.onerror=()=>a.remove(),M.appendChild(a)}const N=document.createElement("span");N.className="tab-title",N.textContent=e.title||"Untitled",N.title=e.title||"Untitled",M.appendChild(N),L.appendChild(M);const S=document.createElement("div");S.className="tab-url",S.textContent=V(e.url),S.title=e.url||"",L.appendChild(S),n.appendChild(L);const P=document.createElement("button");if(P.className="tab-close-btn",P.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>`,P.title="Close tab",n.appendChild(P),e.audible&&!e.mutedInfo?.muted){const a=document.createElement("div");a.className="tab-audio-indicator",a.innerHTML='<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>',n.appendChild(a)}else if(e.mutedInfo?.muted){const a=document.createElement("div");a.className="tab-audio-indicator muted",a.innerHTML='<svg viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>',n.appendChild(a)}return n}function F(e){return(e.replace(/[^a-zA-Z0-9]/g,"")[0]||"T").toUpperCase()}function V(e){if(!e)return"";try{return new URL(e).hostname.replace(/^www\./,"")}catch{return e.slice(0,50)}}function re(e){const t={grey:"#5f6368",blue:"#1a73e8",red:"#d93025",yellow:"#f9ab00",green:"#1e8e3e",pink:"#d01884",purple:"#9334e6",cyan:"#007b83",orange:"#e8710a"};return t[e]||t.grey}document.addEventListener("DOMContentLoaded",_);
