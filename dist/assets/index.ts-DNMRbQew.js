const l={MAX_CACHED_TABS:30,MAX_CACHE_BYTES:20971520,MAX_SCREENSHOT_SIZE:204800,JPEG_QUALITY:60,CAPTURE_DELAY:100,SCREENSHOT_CACHE_DURATION:3e5,MAX_CAPTURES_PER_SECOND:2,THROTTLE_INTERVAL:500,PERFORMANCE_LOGGING:!0,QUALITY_TIERS:{HIGH:{quality:80,maxSize:307200,label:"High Quality"},NORMAL:{quality:60,maxSize:204800,label:"Normal"},PERFORMANCE:{quality:40,maxSize:102400,label:"Performance"}},DEFAULT_QUALITY_TIER:"PERFORMANCE",ALARMS:{IDLE_CHECK:"idle-screenshot-check",PERF_LOG:"performance-log"}};class W{dbName;storeName;db;initPromise;constructor(t,r){this.dbName=t,this.storeName=r,this.db=null,this.initPromise=this._open()}_open(){return new Promise((t,r)=>{const a=indexedDB.open(this.dbName,1);a.onerror=()=>r(a.error),a.onsuccess=()=>{this.db=a.result,t(this.db)},a.onupgradeneeded=o=>{const s=o.target.result;s.objectStoreNames.contains(this.storeName)||s.createObjectStore(this.storeName)}})}async getAll(){if(await this.initPromise,!this.db)throw new Error("DB not initialized");return new Promise((t,r)=>{const s=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();s.onsuccess=()=>t(s.result),s.onerror=()=>r(s.error)})}async getAllKeys(){if(await this.initPromise,!this.db)throw new Error("DB not initialized");return new Promise((t,r)=>{const s=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAllKeys();s.onsuccess=()=>t(s.result),s.onerror=()=>r(s.error)})}async set(t,r){if(await this.initPromise,!this.db)throw new Error("DB not initialized");return new Promise((a,o)=>{const d=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put(r,t);d.onsuccess=()=>a(),d.onerror=()=>o(d.error)})}async delete(t){if(await this.initPromise,!this.db)throw new Error("DB not initialized");return new Promise((r,a)=>{const i=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(t);i.onsuccess=()=>r(),i.onerror=()=>a(i.error)})}async clear(){if(await this.initPromise,!this.db)throw new Error("DB not initialized");return new Promise((t,r)=>{const s=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();s.onsuccess=()=>t(),s.onerror=()=>r(s.error)})}}class Y{cache;maxTabs;maxBytes;currentBytes;accessOrder;storage;ready;constructor(t=30,r=20*1024*1024){this.cache=new Map,this.maxTabs=t,this.maxBytes=r,this.currentBytes=0,this.accessOrder=[],this.storage=new W("TabSwitcherDB","screenshots"),this.ready=this._restoreFromStorage()}async _restoreFromStorage(){try{const t=await this.storage.getAllKeys();if(t.length===0)return;const r=await this.storage.getAll();t.forEach((a,o)=>{const s=r[o];if(typeof a!="number"||!s||typeof s!="object")return;const i=s;typeof i.data=="string"&&typeof i.size=="number"&&typeof i.timestamp=="number"&&(this.cache.set(a,i),this.currentBytes+=i.size)}),this.accessOrder=Array.from(this.cache.entries()).sort((a,o)=>o[1].timestamp-a[1].timestamp).map(a=>a[0]),console.log(`[CACHE] Restored ${this.cache.size} screenshots from storage`)}catch(t){console.error("[CACHE] Failed to restore from storage:",t)}}get(t){if(!this.cache.has(t))return null;this.accessOrder=this.accessOrder.filter(a=>a!==t),this.accessOrder.unshift(t);const r=this.cache.get(t);return r.timestamp=Date.now(),this.storage.set(t,r).catch(a=>console.warn("Failed to update timestamp",a)),r}set(t,r){const a=this._estimateSize(r);if(this.cache.has(t)){const s=this.cache.get(t).size;this.currentBytes-=s}for(;(this.cache.size>=this.maxTabs||this.currentBytes+a>this.maxBytes)&&this.cache.size>0;)this._evictLRU();const o={data:r,size:a,timestamp:Date.now()};this.cache.set(t,o),this.currentBytes+=a,this.accessOrder=this.accessOrder.filter(s=>s!==t),this.accessOrder.unshift(t),this.storage.set(t,o).catch(s=>console.error("Failed to persist screenshot",s))}delete(t){if(!this.cache.has(t))return!1;const r=this.cache.get(t);return r?(this.currentBytes-=r.size,this.cache.delete(t),this.accessOrder=this.accessOrder.filter(a=>a!==t),this.storage.delete(t).catch(a=>console.error("Failed to delete screenshot",a)),!0):!1}_evictLRU(){if(this.accessOrder.length===0)return;const t=this.accessOrder.pop();if(t===void 0)return;const r=this.cache.get(t);r&&(this.currentBytes-=r.size,this.cache.delete(t),this.storage.delete(t).catch(a=>console.warn("Failed to evict from storage",a)),console.debug(`[LRU] Evicted tab ${t} (${(r.size/1024).toFixed(1)}KB)`))}_estimateSize(t){return Math.ceil(t.length*.75)}getStats(){return{entries:this.cache.size,bytes:this.currentBytes,maxTabs:this.maxTabs,maxBytes:this.maxBytes,utilizationPercent:(this.currentBytes/this.maxBytes*100).toFixed(1)}}clear(){this.cache.clear(),this.accessOrder=[],this.currentBytes=0,this.storage.clear().catch(t=>console.error("Failed to clear storage",t))}}const A={overlayOpenTimes:[],captureCount:0,cacheHits:0,cacheMisses:0,recordOverlayOpen(e){this.overlayOpenTimes.push(e),this.overlayOpenTimes.length>100&&this.overlayOpenTimes.shift(),console.log(`[PERF] Overlay open: ${e.toFixed(2)}ms (Target: <100ms)`)},getAverageOverlayTime(){return this.overlayOpenTimes.length===0?0:this.overlayOpenTimes.reduce((t,r)=>t+r,0)/this.overlayOpenTimes.length},logStats(e){const t=e.getStats(),r=this.getAverageOverlayTime();console.log("[STATS] ═══════════════════════════════════════"),console.log(`[STATS] Cache: ${t.entries}/${t.maxTabs} tabs`),console.log(`[STATS] Memory: ${(t.bytes/1024/1024).toFixed(2)}MB / ${(t.maxBytes/1024/1024).toFixed(2)}MB (${t.utilizationPercent}%)`),console.log(`[STATS] Captures: ${this.captureCount} (Hits: ${this.cacheHits}, Misses: ${this.cacheMisses})`),console.log(`[STATS] Avg Overlay Open: ${r.toFixed(2)}ms (Target: <100ms)`),console.log("[STATS] ═══════════════════════════════════════")}},h=new Set;function M(){try{chrome.storage.session.set({tabsWithMedia:Array.from(h)})}catch{}}async function j(){try{const e=await chrome.storage.session.get("tabsWithMedia");e.tabsWithMedia&&Array.isArray(e.tabsWithMedia)&&e.tabsWithMedia.forEach(t=>h.add(t))}catch{}}function X(e){return h.has(e)}function L(e){h.has(e)||(h.add(e),M(),console.debug(`[MEDIA] Tab ${e} marked as having media`))}function k(e){h.has(e)&&(h.delete(e),M())}async function K(){try{const e=await chrome.tabs.query({audible:!0});for(const r of e)r.id&&!h.has(r.id)&&h.add(r.id);const t=await chrome.tabs.query({});for(const r of t)r.id&&r.mutedInfo?.muted&&!h.has(r.id)&&h.add(r.id);h.size>0&&(M(),console.log(`[MEDIA] Initialized ${h.size} tabs with media`))}catch(e){console.debug("[MEDIA] Error initializing audible tabs:",e)}}let f=[];const T=new Map;let _=null,N=Date.now(),F=!1,C=null;function V(e){return T.get(e)}function J(){return _}function q(){return N}function Z(){return F}function ee(e){_=e}function D(){N=Date.now()}function U(e,t){T.set(e,t??Date.now())}function B(e){z(e),f.unshift(e),f.length>l.MAX_CACHED_TABS*2&&(f.length=l.MAX_CACHED_TABS*2),re()}function z(e){const t=f.indexOf(e);t!==-1&&f.splice(t,1)}function te(e){T.delete(e)}function re(){C&&clearTimeout(C),C=setTimeout(()=>{chrome.storage.local.set({recentTabOrder:f.slice(0,100)}).catch(e=>console.debug("[STORAGE] Failed to save recent order:",e))},500)}async function $(){try{const e=await chrome.storage.local.get(["recentTabOrder"]);if(e.recentTabOrder&&Array.isArray(e.recentTabOrder)){const t=await chrome.tabs.query({}),r=new Set(t.map(a=>a.id));f=e.recentTabOrder.filter(a=>r.has(a)),console.log(`[INIT] Restored ${f.length} recent tab order entries`)}}catch(e){console.debug("[STORAGE] Failed to restore recent order:",e)}F=!0}function se(e){return[...e].sort((t,r)=>{const a=t.lastAccessed||0,o=r.lastAccessed||0;if(a&&o)return o-a;if(a)return-1;if(o)return 1;const s=typeof t.id=="number"?f.indexOf(t.id):-1,i=typeof r.id=="number"?f.indexOf(r.id):-1;if(s!==-1&&i!==-1)return s-i;if(s!==-1)return-1;if(i!==-1)return 1;const d=typeof t.id=="number"?T.get(t.id)??0:0,u=typeof r.id=="number"?T.get(r.id)??0:0;return d!==u?u-d:(r.index??0)-(t.index??0)})}async function ae(){try{await $();const e=await chrome.tabs.query({}),t=Date.now();e.forEach((a,o)=>{a.id&&!T.has(a.id)&&T.set(a.id,t-(e.length-o)*1e3)});const r=await chrome.windows.getAll();for(const a of r){const[o]=await chrome.tabs.query({windowId:a.id,active:!0});o&&o.id&&(f.indexOf(o.id)===-1&&B(o.id),_=o.id)}console.log(`[INIT] Initialized ${e.length} existing tabs, ${f.length} in recent order`)}catch(e){console.error("[INIT] Failed to initialize existing tabs:",e)}}const y=[];let x=0,v=!1;const p=new Set;let E=l.DEFAULT_QUALITY_TIER;function oe(e){return l.QUALITY_TIERS[e]?(E=e,!0):!1}async function ie(){try{const t=(await chrome.storage.local.get(["qualityTier"]))?.qualityTier;t&&l.QUALITY_TIERS[t]?(E=t,console.log(`[INIT] Loaded quality tier: ${E}`)):console.log("[INIT] Using default quality tier:",E)}catch(e){const t=e instanceof Error?e.message:typeof e=="string"?e:String(e);console.warn("[INIT] Failed to load quality tier, using default:",t)}}function S(e,t,r=!1){if(y.some(o=>o.tabId===e)||p.has(e))return;const a={tabId:e,timestamp:Date.now()};r?y.unshift(a):y.push(a),ce(t)}async function ce(e){if(!(v||y.length===0)){for(v=!0;y.length>0;){const r=Date.now()-x;if(r<l.THROTTLE_INTERVAL){const o=l.THROTTLE_INTERVAL-r;await new Promise(s=>setTimeout(s,o))}const a=y.shift();if(a&&a.tabId){p.add(a.tabId);try{await H(a.tabId,e)}finally{p.delete(a.tabId)}}x=Date.now()}v=!1}}async function H(e,t,r=null){try{const a=await chrome.tabs.get(e);if(!a.active)return console.debug(`[CAPTURE] Tab ${e} is not active, skipping capture`),null;if(!R(a))return console.debug(`[CAPTURE] Tab ${e} not capturable: ${a.url}`),null;await new Promise(b=>setTimeout(b,l.CAPTURE_DELAY+50));const o=await chrome.tabs.get(e).catch(()=>null);if(!o||!o.active)return console.debug(`[CAPTURE] Tab ${e} no longer active after delay`),null;const s=r||E,i=l.QUALITY_TIERS[s]||l.QUALITY_TIERS.NORMAL,d=performance.now();let u=null;try{u=await chrome.tabs.captureVisibleTab(a.windowId,{format:"jpeg",quality:i.quality})}catch{console.debug("[CAPTURE] First attempt failed, retrying with lower quality");try{await new Promise(c=>setTimeout(c,100)),u=await chrome.tabs.captureVisibleTab(a.windowId,{format:"jpeg",quality:Math.max(30,i.quality-20)})}catch(c){const w=c instanceof Error?c.message:String(c);return console.debug(`[CAPTURE] Retry also failed for tab ${e}:`,w),null}}if(!u)return console.debug(`[CAPTURE] No screenshot data for tab ${e}`),null;const m=performance.now()-d,n=t._estimateSize(u);return n>i.maxSize*1.5&&console.warn(`[CAPTURE] Screenshot large: ${(n/1024).toFixed(1)}KB (target: ${(i.maxSize/1024).toFixed(1)}KB)`),t.set(e,u),A.captureCount++,l.PERFORMANCE_LOGGING&&console.debug(`[CAPTURE] Tab ${e}: ${m.toFixed(2)}ms, ${(n/1024).toFixed(1)}KB (${i.label})`),u}catch(a){const o=a instanceof Error?a.message:String(a);return console.debug(`[CAPTURE] Failed for tab ${e}:`,o),null}}function R(e){if(e.discarded||!e.url)return!1;const t=["chrome://","edge://","devtools://","view-source:"];return!(e.url&&t.some(r=>e.url.startsWith(r)))}function ne(e){p.delete(e)}const le="/assets/index.ts-loader-C-HKZYLO.js";async function ue(e,t,r,a,o){try{if(!e||!e.action){console.error("[ERROR] Invalid message received:",e),r({success:!1,error:"Invalid message format"});return}switch(e.action){case"reportMediaPresence":t.tab&&t.tab.id&&L(t.tab.id),r({success:!0});break;case"getRecentlyClosed":try{const i=Math.min(25,typeof e.maxResults=="number"?e.maxResults:10),d=await chrome.sessions.getRecentlyClosed({maxResults:25}),u=[];for(const n of d)if(n.tab)u.push({kind:"tab",sessionId:n.tab.sessionId,lastModified:n.lastModified,title:n.tab.title||"Untitled",url:n.tab.url||"",favIconUrl:n.tab.favIconUrl||""});else if(n.window&&Array.isArray(n.window.tabs))for(const b of n.window.tabs)u.push({kind:"tab",sessionId:b.sessionId||n.window.sessionId,lastModified:n.lastModified,title:b.title||"Untitled",url:b.url||"",favIconUrl:b.favIconUrl||""});else n.window&&n.window.sessionId&&u.push({kind:"window",sessionId:n.window.sessionId,lastModified:n.lastModified,title:"Window",url:"",favIconUrl:""});u.sort((n,b)=>(b.lastModified||0)-(n.lastModified||0));const m=u.slice(0,i);r({success:!0,items:m})}catch(s){console.error("[ERROR] Failed to get recently closed:",s),r({success:!1,error:s.message})}break;case"restoreSession":try{if(!e.sessionId||typeof e.sessionId!="string"){r({success:!1,error:"Invalid sessionId"});return}const s=await chrome.sessions.restore(e.sessionId);r({success:!0,restored:s})}catch(s){console.error("[ERROR] Failed to restore session:",s),r({success:!1,error:s.message})}break;case"switchToTab":if(!e.tabId||typeof e.tabId!="number"){r({success:!1,error:"Invalid tab ID"});return}try{await chrome.tabs.update(e.tabId,{active:!0}),r({success:!0})}catch(s){console.error("[ERROR] Failed to switch to tab:",s),r({success:!1,error:s.message})}break;case"closeTab":if(!e.tabId||typeof e.tabId!="number"){r({success:!1,error:"Invalid tab ID"});return}try{if(!await chrome.tabs.get(e.tabId).catch(()=>null)){console.warn("[WARNING] Tab no longer exists:",e.tabId),r({success:!1,error:"Tab no longer exists"});return}await chrome.tabs.remove(e.tabId),r({success:!0})}catch(s){console.error("[ERROR] Failed to close tab:",s),r({success:!1,error:s.message})}break;case"toggleMute":if(!e.tabId||typeof e.tabId!="number"){r({success:!1,error:"Invalid tab ID"});return}try{const i=!((await chrome.tabs.get(e.tabId)).mutedInfo?.muted??!1);await chrome.tabs.update(e.tabId,{muted:i}),r({success:!0,muted:i})}catch(s){console.error("[ERROR] Failed to toggle mute:",s),r({success:!1,error:s.message})}break;case"togglePlayPause":if(!e.tabId||typeof e.tabId!="number"){r({success:!1,error:"Invalid tab ID"});return}try{const s=await chrome.tabs.get(e.tabId);if(R(s)){const i=await chrome.scripting.executeScript({target:{tabId:e.tabId},func:()=>{const d=[...document.querySelectorAll("video, audio")];return d.length===0?{success:!1,reason:"no_media"}:d.some(m=>!m.paused&&!m.ended)?(d.forEach(m=>m.pause()),{success:!0,playing:!1}):(d.forEach(m=>m.play().catch(()=>{})),{success:!0,playing:!0})}});i&&i[0]?r({success:!0,...i[0].result}):r({success:!1,error:"Script execution failed"})}else r({success:!1,error:"Cannot script in this tab"})}catch(s){console.error("[ERROR] Failed to toggle play/pause:",s),r({success:!1,error:s.message})}break;case"refreshTabList":try{await o(),r({success:!0})}catch(s){console.error("[ERROR] Failed to refresh tab list:",s),r({success:!1,error:s.message})}break;case"captureTabScreenshot":if(!e.tabId||typeof e.tabId!="number"){r({success:!1,error:"Invalid tab ID"});return}try{const s=await H(e.tabId,a);r({success:!!s,screenshot:s})}catch(s){console.error("[ERROR] Failed to capture screenshot:",s),r({success:!1,error:s.message})}break;case"getCacheStats":try{const s=a.getStats();r({success:!0,stats:s})}catch(s){console.error("[ERROR] Failed to get cache stats:",s),r({success:!1,error:s.message})}break;case"setQualityTier":try{const s=e.tier||l.DEFAULT_QUALITY_TIER;oe(s)?(chrome.storage.local.set({qualityTier:s}),console.log(`[SETTINGS] Quality tier changed to: ${s}`),r({success:!0,tier:s})):r({success:!1,error:"Invalid quality tier"})}catch(s){console.error("[ERROR] Failed to set quality tier:",s),r({success:!1,error:s.message})}break;case"createGroup":try{if(e.tabId&&chrome.tabs.group){const s=await chrome.tabs.group({tabIds:e.tabId});r({success:!0,groupId:s})}else r({success:!1,error:"Missing tabId or API not supported"})}catch(s){console.error("[GROUPS] Failed to create group:",s),r({success:!1,error:s.message})}break;default:console.warn("[WARNING] Unknown action:",e.action),r({success:!1,error:"Unknown action"})}}catch(s){console.error("[ERROR] Message handler failed:",s),r({success:!1,error:s.message})}}async function de(e,t,r=1){try{await chrome.tabs.sendMessage(e,t)}catch(a){if(r>0&&a.message&&a.message.includes("Could not establish connection")){console.log("[INJECT] Content script not ready, injecting...");try{await chrome.scripting.executeScript({target:{tabId:e},files:[le]}),await new Promise(o=>setTimeout(o,150)),await chrome.tabs.sendMessage(e,t)}catch(o){const s=o&&o.message?o.message:"";if(s.includes("cannot be scripted")||s.includes("Cannot access a chrome://")||s.includes("Cannot access a chrome-extension://")||s.includes("Cannot access")&&s.includes("URL"))console.warn("[INJECT] Cannot inject on this page (protected URL). Try on a regular webpage.");else throw o}}else throw a}}const g=new Y(l.MAX_CACHED_TABS,l.MAX_CACHE_BYTES);async function he(){console.log("═══════════════════════════════════════════════════════"),console.log("Visual Tab Switcher - Performance Optimized (Modular)"),console.log("═══════════════════════════════════════════════════════"),console.log(`Cache: Max ${l.MAX_CACHED_TABS} tabs, ${(l.MAX_CACHE_BYTES/1024/1024).toFixed(2)}MB`),console.log(`Rate Limit: ${l.MAX_CAPTURES_PER_SECOND} captures/sec`),console.log("Target: <100ms overlay open, <50MB memory, 60fps"),console.log("═══════════════════════════════════════════════════════"),await j(),await ie(),setTimeout(async()=>{await ae(),await K();const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});e?.id&&S(e.id,g,!0)},100),await me()}async function me(){await chrome.alarms.clearAll(),chrome.alarms.create(l.ALARMS.IDLE_CHECK,{delayInMinutes:1,periodInMinutes:1}),chrome.alarms.create(l.ALARMS.PERF_LOG,{delayInMinutes:1,periodInMinutes:1}),console.log("[ALARMS] Periodic alarms set up successfully")}chrome.alarms.onAlarm.addListener(async e=>{switch(e.name){case l.ALARMS.IDLE_CHECK:await fe();break;case l.ALARMS.PERF_LOG:A.logStats(g);break}});async function fe(){try{const e=J();if(!e)return;const t=300*1e3,r=q();Date.now()-r>t&&(console.debug(`[IDLE] Tab ${e} idle > 5m, refreshing screenshot`),D(),S(e,g,!0))}catch(e){console.debug("[IDLE] Error in idle check:",e)}}let I=null;typeof chrome<"u"&&chrome.tabs?(chrome.tabs.onActivated.addListener(async e=>{try{ee(e.tabId),D(),B(e.tabId),I&&clearTimeout(I),I=setTimeout(()=>{S(e.tabId,g,!0),I=null},500)}catch(t){console.debug("[TAB] Error in onActivated:",t)}}),chrome.tabs.onUpdated.addListener((e,t,r)=>{try{t.audible!==void 0&&t.audible&&L(e),t.status==="complete"&&r.active&&setTimeout(()=>{S(e,g,!0)},300)}catch(a){console.debug("[TAB] Error in onUpdated:",a)}}),chrome.tabs.onCreated.addListener(e=>{try{e.id&&U(e.id)}catch(t){console.debug("[TAB] Error in onCreated:",t)}}),chrome.tabs.onRemoved.addListener(e=>{try{g.delete(e),z(e),te(e),ne(e),k(e),console.debug(`[CLEANUP] Removed tab ${e} from cache`)}catch(t){console.debug("[TAB] Error in onRemoved:",t)}})):console.error("[INIT] chrome.tabs API not available");typeof chrome<"u"&&chrome.commands&&chrome.commands.onCommand.addListener(e=>{(e==="show-tab-switcher"||e==="cycle-next-tab")&&G()});async function G(){g.ready&&await g.ready,Z()||await $();const e=performance.now();try{const t=await chrome.windows.getCurrent(),r=await chrome.tabs.query({windowId:t.id}),a=r.filter(c=>typeof c.id=="number");let o=[];if(chrome.tabGroups)try{o=await chrome.tabGroups.query({windowId:t.id})}catch(c){console.debug("[GROUPS] Failed to fetch groups:",c)}const s=Date.now();a.forEach((c,w)=>{V(c.id)||U(c.id,s-(r.length-w)*1e3)});const i=se(a),d=8,u=i.map((c,w)=>{let O=null;const Q=w<d;if(R(c)&&Q){const P=g.get(c.id);P?(O=P,A.cacheHits++):A.cacheMisses++}return{id:c.id,title:c.title||"Untitled",url:c.url,favIconUrl:c.favIconUrl,screenshot:O?O.data:null,pinned:c.pinned,index:c.index,active:c.active,audible:c.audible,mutedInfo:c.mutedInfo,groupId:c.groupId,hasMedia:X(c.id)||c.audible}}),m=o.map(c=>({id:c.id,title:c.title,color:c.color,collapsed:c.collapsed})),[n]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!n||typeof n.id!="number"){console.warn("[INJECT] No active tab found to open overlay");return}if(!R(n)){console.warn("[INJECT] Cannot open overlay on protected page. Switch to a regular webpage and try again.");return}await de(n.id,{action:"showTabSwitcher",tabs:u,groups:m,activeTabId:n.id});const b=performance.now()-e;A.recordOverlayOpen(b)}catch(t){console.error("[ERROR] Failed to show tab switcher:",t)}}typeof chrome<"u"&&chrome.runtime&&chrome.runtime.onMessage&&chrome.runtime.onMessage.addListener((e,t,r)=>(ue(e,t,r,g,G),!0));he().catch(e=>{console.error("[INIT] Failed to initialize:",e)});
