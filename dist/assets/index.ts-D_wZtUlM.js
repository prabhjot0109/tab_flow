console.log("[Tab Flow] Content script messaging module loaded");const e={overlay:null,currentTabs:[],activeTabs:[],filteredTabs:[],selectedIndex:0,isOverlayVisible:!1,viewMode:"active",recentItems:[],groups:[],collapsedGroups:new Set,host:null,shadowRoot:null,styleElement:null,lastFullscreenElement:null,domCache:{grid:null,searchBox:null,container:null,searchWrap:null,sectionTitle:null,tabHint:null},virtualScroll:{startIndex:0,endIndex:0,visibleCount:20,bufferCount:5},lastKeyTime:0,keyThrottleMs:16,resizeObserver:null,intersectionObserver:null,focusInterval:null,closeTimeout:null,isClosing:!1,pageLock:null,history:{active:!1,backEls:[],forwardEls:[],column:"back",index:0},webSearch:{active:!1}},he='*,*:before,*:after{box-sizing:border-box;margin:0;padding:0}:host{all:initial!important;display:contents!important;--bg-overlay: transparent;--bg-surface: #161616;--bg-glass: #303030;--bg-glass-hover: #333333;--border-subtle: rgba(255, 255, 255, .1);--border-hover: rgba(255, 255, 255, .15);--border-active: rgba(255, 255, 255, .25);--text-primary: #ffffff;--text-secondary: #a0a0a0;--text-muted: #666666;--accent: #ffffff;--accent-light: #e0e0e0;--accent-glow: rgba(255, 255, 255, .1);--card-bg: #303030;--card-hover: #2f2f2f;--card-selected: #3a3a3a;--danger: #ff6b6b;--success: #59d499;--radius-3xl: 12px;--radius-2xl: 10px;--radius-xl: 8px;--radius-lg: 8px;--radius-md: 6px;--radius-sm: 5px;--radius-xs: 4px;--radius-full: 9999px;--shadow-xl: 0 4px 16px rgba(0, 0, 0, .18);--shadow-card: 0 2px 6px rgba(0, 0, 0, .12);--font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Inter", sans-serif;--transition-fast: .1s ease;--transition-smooth: .15s cubic-bezier(.2, 0, 0, 1)}@media(prefers-color-scheme:light){:host{--bg-overlay: transparent;--bg-surface: #ffffff;--bg-glass: #f5f5f5;--bg-glass-hover: #ebebeb;--border-subtle: rgba(0, 0, 0, .1);--border-hover: rgba(0, 0, 0, .15);--border-active: rgba(0, 0, 0, .25);--text-primary: #000000;--text-secondary: #666666;--text-muted: #999999;--accent: #000000;--accent-light: #333333;--accent-glow: rgba(0, 0, 0, .08);--card-bg: #f8f8f8;--card-hover: #f0f0f0;--card-selected: #e5e5e5;--shadow-xl: 0 4px 16px rgba(0, 0, 0, .12);--shadow-card: 0 2px 6px rgba(0, 0, 0, .08)}}.tab-flow-overlay{position:fixed;inset:0;z-index:2147483647;display:none;align-items:center;justify-content:center;padding:20px;font-family:var(--font-family);font-size:14px;line-height:1.5;color:var(--text-primary);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;pointer-events:auto;overscroll-behavior:contain}.tab-flow-backdrop{position:absolute;inset:0;background:var(--bg-overlay)}.tab-flow-container{position:relative;width:750px;max-width:94vw;max-height:min(68vh,600px);background:var(--bg-surface);border:1px solid var(--border-subtle);border-radius:var(--radius-3xl);box-shadow:var(--shadow-xl);display:flex;flex-direction:column;padding:0;overflow:hidden;animation:containerFadeIn .15s ease-out}.tab-flow-search-row{display:flex;align-items:center;gap:0;padding:0;flex-shrink:0;border-bottom:1px solid var(--border-subtle);background:transparent}.tab-flow-search-wrap{flex:1;position:relative;display:flex;align-items:center}.tab-flow-search{width:100%;background:transparent;border:none;border-radius:0;padding:22px 24px 22px 56px;font-size:17px;font-weight:400;color:var(--text-primary);outline:none;transition:none;letter-spacing:-.01em;caret-color:var(--accent)}.tab-flow-search:focus{background:transparent;border-color:transparent;box-shadow:none}.tab-flow-search::placeholder{color:var(--text-muted);font-weight:400}.search-icon{position:absolute;left:18px;color:var(--text-muted);pointer-events:none;display:flex;align-items:center;transition:color var(--transition-fast)}.tab-flow-search:focus~.search-icon,.tab-flow-search-wrap:focus-within .search-icon{color:var(--text-muted);transform:none}.search-tab-hint{position:absolute;right:16px;display:flex;align-items:center;gap:6px;color:var(--text-muted);font-size:12px;pointer-events:none;opacity:1;transition:opacity var(--transition-fast)}.search-tab-hint kbd{display:inline-flex;align-items:center;justify-content:center;min-width:22px;height:20px;padding:0 6px;background:var(--bg-glass);border:1px solid var(--border-subtle);border-radius:var(--radius-xs);font-size:11px;font-weight:500;font-family:inherit;color:var(--text-secondary)}.search-tab-hint.hidden{opacity:0}.tab-flow-section-header{display:flex;align-items:center;justify-content:space-between;padding:10px 16px 2px;flex-shrink:0}.tab-flow-section-title{font-size:12px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em}.tab-flow-view-toggle{display:flex;align-items:center;gap:2px;background:var(--bg-glass);border-radius:var(--radius-sm);padding:2px}.view-toggle-btn{display:flex;align-items:center;justify-content:center;width:28px;height:24px;border:none;background:transparent;color:var(--text-muted);border-radius:var(--radius-xs);cursor:pointer;transition:all var(--transition-fast)}.view-toggle-btn:hover{color:var(--text-secondary);background:var(--bg-glass-hover)}.view-toggle-btn.active{background:var(--bg-glass-hover);color:var(--text-primary)}.view-toggle-btn svg{width:14px;height:14px}.recent-back-btn{position:absolute;left:8px;z-index:10;width:28px;height:28px;display:flex;align-items:center;justify-content:center;border:none;background:transparent;color:var(--text-secondary);border-radius:var(--radius-sm);cursor:pointer;font-size:16px;transition:all var(--transition-fast)}.recent-back-btn:hover{background:var(--bg-glass-hover);color:var(--text-primary);transform:none}.tab-flow-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;overflow-y:auto;overflow-x:hidden;padding:12px;min-height:180px;scroll-behavior:smooth;overscroll-behavior:contain}.tab-flow-grid.list-view{display:flex;flex-direction:column;gap:12px}.tab-flow-grid.list-view .tab-card{width:100%;height:auto;min-height:52px;flex-direction:row;align-items:center;padding:10px 14px;gap:12px}.tab-flow-grid.list-view .tab-card:hover{transform:none}.tab-flow-grid.list-view .tab-card.selected{transform:none!important}.tab-flow-grid.list-view .tab-thumbnail{flex:0 0 36px;height:36px;width:36px;min-height:36px;border-radius:var(--radius-sm)}.tab-flow-grid.list-view .tab-info{flex:1;padding:0;min-width:0}.tab-flow-grid.list-view .tab-title{font-size:14px}.tab-flow-grid.list-view .tab-url{padding-left:0;font-size:12px}.tab-flow-grid.list-view .tab-close-btn{position:relative;top:auto;right:auto;opacity:0;width:24px;height:24px;flex-shrink:0}.tab-flow-grid.list-view .tab-card:hover .tab-close-btn{opacity:1}.tab-flow-grid.list-view .tab-media-controls{position:relative;bottom:auto;right:auto;opacity:1;display:flex;margin-right:8px;flex-shrink:0}.tab-flow-grid.list-view .tab-play-btn,.tab-flow-grid.list-view .tab-mute-btn{opacity:.6}.tab-flow-grid.list-view .tab-card:hover .tab-play-btn,.tab-flow-grid.list-view .tab-card:hover .tab-mute-btn,.tab-flow-grid.list-view .tab-play-btn.playing,.tab-flow-grid.list-view .tab-play-btn.visible,.tab-flow-grid.list-view .tab-mute-btn.muted,.tab-flow-grid.list-view .tab-mute-btn.visible,.tab-flow-grid.list-view .tab-card.has-media .tab-play-btn,.tab-flow-grid.list-view .tab-card.has-media .tab-mute-btn,.tab-flow-grid.list-view .tab-card.is-audible .tab-play-btn,.tab-flow-grid.list-view .tab-card.is-audible .tab-mute-btn,.tab-flow-grid.list-view .tab-card.is-muted .tab-mute-btn{opacity:1}.tab-flow-grid.recent-mode,.tab-flow-grid.search-mode{display:flex;flex-direction:column;gap:12px;min-height:auto}.tab-flow-grid.recent-mode .tab-media-controls,.tab-flow-grid.search-mode .tab-media-controls{position:relative;bottom:auto;right:auto;opacity:1;display:flex;margin-right:8px;flex-shrink:0}.tab-flow-grid.recent-mode .tab-play-btn,.tab-flow-grid.recent-mode .tab-mute-btn,.tab-flow-grid.search-mode .tab-play-btn,.tab-flow-grid.search-mode .tab-mute-btn{opacity:.6}.tab-flow-grid.recent-mode .tab-card:hover .tab-play-btn,.tab-flow-grid.recent-mode .tab-card:hover .tab-mute-btn,.tab-flow-grid.search-mode .tab-card:hover .tab-play-btn,.tab-flow-grid.search-mode .tab-card:hover .tab-mute-btn,.tab-flow-grid.recent-mode .tab-card.has-media .tab-play-btn,.tab-flow-grid.recent-mode .tab-card.has-media .tab-mute-btn,.tab-flow-grid.search-mode .tab-card.has-media .tab-play-btn,.tab-flow-grid.search-mode .tab-card.has-media .tab-mute-btn,.tab-flow-grid.recent-mode .tab-card.is-audible .tab-play-btn,.tab-flow-grid.recent-mode .tab-card.is-audible .tab-mute-btn,.tab-flow-grid.search-mode .tab-card.is-audible .tab-play-btn,.tab-flow-grid.search-mode .tab-card.is-audible .tab-mute-btn{opacity:1}.tab-flow-grid::-webkit-scrollbar{width:6px}.tab-flow-grid::-webkit-scrollbar-track{background:transparent;margin:4px 0}.tab-flow-grid::-webkit-scrollbar-thumb{background:#ffffff26;border-radius:100px;transition:background .2s ease}.tab-flow-grid::-webkit-scrollbar-thumb:hover{background:#ffffff40}.tab-flow-grid::-webkit-scrollbar-thumb:active{background:#ffffff59}.tab-flow-grid{scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.15) transparent}@media(prefers-color-scheme:light){.tab-flow-grid::-webkit-scrollbar-thumb{background:#0000001f}.tab-flow-grid::-webkit-scrollbar-thumb:hover{background:#0003}.tab-flow-grid::-webkit-scrollbar-thumb:active{background:#0000004d}.tab-flow-grid{scrollbar-color:rgba(0,0,0,.12) transparent}}.tab-flow-empty{grid-column:1 / -1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 24px;color:var(--text-muted);font-size:14px;text-align:center}.tab-card{background:var(--card-bg);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);overflow:hidden;cursor:pointer;position:relative;display:flex;flex-direction:column;height:160px;transition:all var(--transition-fast);box-shadow:none;contain:content}.tab-card:hover{border-color:var(--border-hover);background:var(--card-hover)}.tab-card.selected{border-color:var(--accent)!important;border-width:2px!important;background:var(--card-selected)!important;box-shadow:0 0 0 2px var(--accent-glow)!important;z-index:50!important}.tab-card.pinned:after{content:"ðŸ“Œ";position:absolute;top:8px;left:8px;font-size:12px;z-index:5;filter:drop-shadow(0 1px 2px rgba(0,0,0,.5))}.tab-audio-indicator{position:absolute;bottom:8px;right:8px;width:24px;height:24px;border-radius:50%;background:#000000d9;display:flex;align-items:center;justify-content:center;color:#fff;z-index:5;opacity:.9}.tab-audio-indicator svg{width:14px;height:14px;fill:currentColor}.tab-audio-indicator.muted{color:#ff5252}.tab-card[data-web-search="1"]{width:100%!important;height:60px!important;flex-direction:row!important;align-items:center!important;padding:0 18px!important;gap:14px!important}.tab-card[data-web-search="1"]:hover{transform:translateY(-2px)}.tab-thumbnail{flex:1;min-height:0;background:linear-gradient(180deg,#00000005,#00000014);position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}.tab-card[data-web-search="1"] .tab-thumbnail{flex:0 0 36px;height:36px;width:36px;border-radius:var(--radius-md);background:var(--bg-glass)}.screenshot-img{width:100%;height:100%;object-fit:cover;object-position:top center;opacity:.95;transition:opacity var(--transition-fast)}.tab-card:hover .screenshot-img,.tab-card.selected .screenshot-img{opacity:1}.favicon-tile{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--bg-glass) 0%,transparent 100%)}.tab-card[data-web-search="1"] .favicon-tile{background:transparent}.favicon-large{width:44px;height:44px;object-fit:contain;border-radius:var(--radius-sm)}.tab-card[data-web-search="1"] .favicon-large{width:26px;height:26px}.favicon-letter{width:48px;height:48px;border-radius:var(--radius-md);background:var(--bg-glass-hover);border:1px solid var(--border-subtle);color:var(--text-primary);display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:600;letter-spacing:-.02em;transition:border-color var(--transition-fast)}.tab-card:hover .favicon-letter,.tab-card.selected .favicon-letter{border-color:var(--accent);background:var(--bg-glass-hover)}.tab-info{padding:12px 14px;background:transparent;position:relative;z-index:1}.tab-card[data-web-search="1"] .tab-info{flex:1!important;padding:0!important;display:flex!important;align-items:center!important}.tab-header{display:flex;align-items:center;gap:10px;margin-bottom:4px}.tab-card[data-web-search="1"] .tab-header{margin:0!important;width:100%!important}.tab-favicon{width:16px;height:16px;opacity:.85;border-radius:3px;flex-shrink:0}.tab-title{font-size:13px;font-weight:500;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;letter-spacing:-.01em}.tab-card.selected .tab-title{color:var(--text-primary);font-weight:700}.tab-card[data-web-search="1"] .tab-title{font-size:15px;font-weight:500}.tab-url{font-size:11px;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-left:26px;letter-spacing:-.01em}.tab-card[data-web-search="1"] .tab-url{display:none}.tab-close-btn{position:absolute;top:10px;right:10px;width:28px;height:28px;border-radius:var(--radius-sm);background:#000c;color:#fff;border:none;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:300;opacity:0;transition:opacity var(--transition-fast),background var(--transition-fast);cursor:pointer;z-index:10}.tab-card:hover .tab-close-btn{opacity:1}.tab-close-btn:hover{background:var(--danger)}.tab-close-btn:active{opacity:.8}.tab-mute-btn.muted{color:#ff5252;background:#000c}.tab-media-controls{position:absolute;bottom:58px;right:12px;display:flex;gap:8px;z-index:10}.tab-play-btn{width:24px;height:24px;border-radius:50%;background:#000000d9;display:flex;align-items:center;justify-content:center;color:#fff;opacity:0;border:none;cursor:pointer;transition:opacity var(--transition-fast),background var(--transition-fast)}.tab-card:hover .tab-play-btn,.tab-play-btn.playing,.tab-play-btn.visible{opacity:.9}.tab-card.has-media .tab-play-btn,.tab-card.is-audible .tab-play-btn{opacity:.85}.tab-play-btn:hover{background:var(--bg-surface);color:var(--text-primary);opacity:1}.tab-play-btn svg{width:14px;height:14px;fill:currentColor}.tab-play-btn.playing{background:#000c}.tab-mute-btn{position:relative;bottom:auto;right:auto;width:24px;height:24px;border-radius:50%;background:#000000d9;display:flex;align-items:center;justify-content:center;color:#fff;opacity:0;border:none;cursor:pointer;transition:opacity var(--transition-fast),background var(--transition-fast)}.tab-card:hover .tab-mute-btn,.tab-mute-btn.muted,.tab-mute-btn.visible{opacity:.9}.tab-card.has-media .tab-mute-btn,.tab-card.is-audible .tab-mute-btn,.tab-card.is-muted .tab-mute-btn{opacity:.85}.tab-mute-btn:hover{background:var(--bg-surface);color:var(--text-primary);opacity:1}.tab-mute-btn svg{width:14px;height:14px;fill:currentColor}.tab-flow-help{display:flex;align-items:center;gap:0;margin-top:0;padding:10px 16px;border-top:1px solid var(--border-subtle);color:var(--text-muted);font-size:12px;justify-content:center;flex-wrap:nowrap;flex-shrink:0;background:var(--bg-surface);min-height:40px}.tab-flow-help span{display:inline-flex;align-items:center;gap:5px;padding:0 12px;white-space:nowrap;border-right:1px solid var(--border-subtle);font-size:11px;color:var(--text-muted)}.tab-flow-help span:last-child{border-right:none}kbd{display:inline-flex;align-items:center;justify-content:center;min-width:20px;height:20px;padding:0 6px;background:var(--bg-glass);border:1px solid var(--border-subtle);border-radius:4px;font-family:-apple-system,BlinkMacSystemFont,SF Pro Text,Segoe UI,sans-serif;font-size:11px;font-weight:500;color:var(--text-secondary);box-shadow:none;transition:none;margin-right:3px}kbd:hover{background:var(--bg-glass-hover);border-color:var(--border-hover);color:var(--text-primary)}@keyframes containerFadeIn{0%{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}.tab-flow-grid.recent-mode .tab-card{width:100%;height:auto;min-height:52px;flex-direction:row;align-items:center;padding:10px 14px;gap:12px;border:1px solid var(--border-subtle);border-radius:var(--radius-md);box-shadow:none}.tab-flow-grid.recent-mode .tab-card:hover{transform:none;border-color:var(--border-hover);box-shadow:none}.tab-flow-grid.recent-mode .tab-card.selected{border-color:var(--accent);background:var(--card-selected);transform:none!important;box-shadow:0 0 0 2px var(--accent-glow)!important}.tab-flow-grid.recent-mode .tab-thumbnail{flex:0 0 40px;height:40px;width:40px;min-height:40px;border-radius:var(--radius-sm);background:var(--bg-glass)}.tab-flow-grid.recent-mode .favicon-tile{border-radius:var(--radius-sm)}.tab-flow-grid.recent-mode .favicon-large{width:26px;height:26px}.tab-flow-grid.recent-mode .favicon-letter{width:40px;height:40px;font-size:17px;border-radius:var(--radius-sm)}.tab-flow-grid.recent-mode .tab-info{flex:1;padding:0;min-width:0}.tab-flow-grid.recent-mode .tab-header{margin-bottom:3px}.tab-flow-grid.recent-mode .tab-title{font-size:14px}.tab-flow-grid.recent-mode .tab-url{padding-left:0;font-size:12px}.tab-flow-grid.recent-mode .tab-close-btn{display:none}.tab-flow-grid.search-mode .tab-card{width:100%;height:auto;min-height:52px;flex-direction:row;align-items:center;padding:10px 14px;gap:12px;border:1px solid var(--border-subtle);border-radius:var(--radius-md);box-shadow:none}.tab-flow-grid.search-mode .tab-card:hover{transform:none;border-color:var(--border-hover);box-shadow:none}.tab-flow-grid.search-mode .tab-card.selected{border-color:var(--accent);background:var(--card-selected);transform:none!important;box-shadow:0 0 0 2px var(--accent-glow)!important}.tab-flow-grid.search-mode .tab-thumbnail{flex:0 0 36px;height:36px;width:36px;min-height:36px;border-radius:var(--radius-sm);background:var(--bg-glass)}.tab-flow-grid.search-mode .tab-info{flex:1;padding:0;min-width:0}.tab-flow-grid.search-mode .tab-title{font-size:14px}.tab-flow-grid.search-mode .tab-url{padding-left:0;font-size:12px;display:block}@media(min-width:1200px)and (min-height:900px){.tab-flow-container{max-height:min(72vh,720px)}}@media(max-width:768px){.tab-flow-container{padding:0;max-width:98vw;max-height:min(85vh,600px)}.tab-flow-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px;padding:10px}.tab-card{height:140px}.tab-flow-help{gap:0;font-size:10px;padding:6px 10px}.tab-flow-help span{padding:0 6px}kbd{min-width:16px;height:16px;padding:0 4px;font-size:9px}.recently-closed-btn{padding:0 12px;font-size:12px}}.history-view{display:grid;grid-template-columns:1fr 1fr;gap:24px;height:100%;overflow:hidden;padding:0 12px}.history-column{display:flex;flex-direction:column;gap:8px;overflow-y:auto;padding-right:4px;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.15) transparent}.history-column::-webkit-scrollbar{width:5px}.history-column::-webkit-scrollbar-track{background:transparent;margin:4px 0}.history-column::-webkit-scrollbar-thumb{background:#ffffff26;border-radius:100px;transition:background .2s ease}.history-column::-webkit-scrollbar-thumb:hover{background:#ffffff40}.history-column::-webkit-scrollbar-thumb:active{background:#ffffff59}@media(prefers-color-scheme:light){.history-column{scrollbar-color:rgba(0,0,0,.12) transparent}.history-column::-webkit-scrollbar-thumb{background:#0000001f}.history-column::-webkit-scrollbar-thumb:hover{background:#0003}.history-column::-webkit-scrollbar-thumb:active{background:#0000004d}}.history-column-header{font-size:14px;font-weight:600;color:var(--text-muted);margin-bottom:8px;padding-left:12px;text-transform:uppercase;letter-spacing:.05em;position:sticky;top:0;background:var(--bg-surface);z-index:10;padding-top:8px;padding-bottom:8px}.history-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:var(--radius-lg);background:var(--card-bg);border:1px solid transparent;cursor:pointer;transition:all var(--transition-fast)}.history-favicon{width:16px;height:16px;border-radius:4px;flex-shrink:0}.history-item:hover{background:var(--card-hover);border-color:var(--border-hover)}.history-item.selected{background:var(--card-selected);border-color:var(--accent)}.history-item-content{flex:1;min-width:0}.history-item-title{font-size:14px;font-weight:500;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px}.history-item-url{font-size:12px;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.history-items-container{display:flex;flex-direction:column;gap:8px}@media(prefers-reduced-motion:reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}.tab-flow-container{animation:none!important}.tab-card{transition:none!important}.tab-card:hover,.tab-card.selected{transform:none!important}}',j="tab-flow-host",pe=he,re=document.createElement("template");re.innerHTML=`
  <div class="tab-card" role="option" tabindex="-1" style="transform: translate3d(0, 0, 0);">
    <div class="tab-thumbnail"></div>
    <div class="tab-info">
      <div class="tab-header">
        <img class="tab-favicon" loading="lazy" decoding="async" style="display: none;">
        <div class="tab-title"></div>
      </div>
      <div class="tab-url" style="display: none;"></div>
    </div>
    <div class="tab-media-controls"></div>
    <button class="tab-close-btn" data-action="close" title="Close tab">Ã—</button>
  </div>
`;const Q="http://www.w3.org/2000/svg";function B(t){const r=document.createElementNS(Q,"svg");r.setAttribute("viewBox","0 0 24 24");const o=document.createElementNS(Q,"path");return o.setAttribute("d",t),r.appendChild(o),r}const me=B("M8 5v14l11-7z"),ge=B("M6 19h4V5H6v14zm8-14v14h4V5h-4z"),ve=B("M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"),we=B("M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z");function xe(t){return t.cloneNode(!0)}function Y(t,r,o,a){const n=document.createElement("button");return n.className=t,n.dataset.action=r,n.title=a,n.appendChild(xe(o)),n}function x(t){const r=performance.now(),o=e.domCache.grid;if(!o)return;if(o.innerHTML="",o.classList.remove("virtual-list"),o.style.minHeight="",o.setAttribute("role","listbox"),o.setAttribute("aria-label","Open tabs"),t.length===0){const i=document.createElement("div");i.className="tab-flow-empty",i.textContent="No tabs found",o.appendChild(i);return}const a=document.createDocumentFragment();t.forEach((i,s)=>{const l=ae(i,s);i.isGroupHeader&&(l.dataset.isHeader="true"),l.dataset.tabIndex=String(s),a.appendChild(l)}),o.appendChild(a),z(!1);const n=performance.now()-r;console.log(`[PERF] Rendered ${t.length} tabs in ${n.toFixed(2)}ms`)}function E(t){const r=performance.now(),o=e.domCache.grid;if(!o)return;if(o.innerHTML="",o.classList.add("virtual-list"),o.setAttribute("role","listbox"),o.setAttribute("aria-label","Open tabs"),t.length===0){const h=document.createElement("div");h.className="tab-flow-empty",h.textContent="No tabs found",o.appendChild(h);return}const a=68,n=e.virtualScroll.visibleCount,i=e.virtualScroll.bufferCount,s=Math.max(0,e.selectedIndex-i),l=Math.min(t.length,e.selectedIndex+n+i);e.virtualScroll.startIndex=s,e.virtualScroll.endIndex=l;const d=t.length*a;o.style.minHeight=`${d}px`;const c=document.createDocumentFragment();for(let h=s;h<l;h++){const k=t[h],m=ae(k,h);m.style.position="absolute",m.style.top=`${h*a}px`,m.style.left="0",m.style.right="0",c.appendChild(m)}o.appendChild(c),ke(),z(!1);const b=performance.now()-r;console.log(`[PERF] Virtual rendered ${l-s} of ${t.length} tabs in ${b.toFixed(2)}ms`)}function ae(t,r){const a=re.content.cloneNode(!0).firstElementChild;t&&typeof t.id=="number"&&(a.dataset.tabId=String(t.id)),t?.sessionId&&(a.dataset.sessionId=t.sessionId,a.dataset.recent="1"),t?.isWebSearch&&(a.dataset.webSearch="1",a.dataset.searchQuery=t.searchQuery),a.dataset.tabIndex=String(r);const n=t.title??"Untitled",i=t.url??"";a.setAttribute("aria-selected",r===e.selectedIndex?"true":"false"),a.setAttribute("aria-label",`${n} - ${i}`);const s=typeof t.screenshot=="string"&&t.screenshot.length>0?t.screenshot:null,l=!!s,d=a.classList;d.add(l?"has-screenshot":"has-favicon"),r===e.selectedIndex&&d.add("selected"),t.pinned&&d.add("pinned"),t.sessionId&&d.add("recent-item");let c=null,b=null;if(t.groupId&&t.groupId!==-1&&e.groups){const u=e.groups.find(f=>f.id===t.groupId);u&&(c=Ce(u.color),b=u.title||"Group",a.dataset.groupId=String(u.id),a.style.borderLeft=`6px solid ${c}`,a.style.background=`linear-gradient(to right, ${c}15, rgba(255,255,255,0.02))`)}const h=a.querySelector(".tab-thumbnail"),k=a.querySelector(".tab-title"),m=a.querySelector(".tab-url"),v=a.querySelector(".tab-favicon"),g=a.querySelector(".tab-media-controls"),T=a.querySelector(".tab-close-btn");if(k.textContent=n,k.title=n,t.sessionId||!s){const u=ye(t);h.appendChild(u)}else if(s){const u=document.createElement("img");u.className="screenshot-img",u.alt=n,u.loading="lazy",u.decoding="async",Math.abs(r-e.selectedIndex)<10?u.src=s:u.dataset.src=s,h.appendChild(u)}if(l){let u=t.favIconUrl;if(!u&&t.url)try{const f=new URL(chrome.runtime.getURL("/_favicon/"));f.searchParams.set("pageUrl",t.url),f.searchParams.set("size","16"),u=f.toString()}catch{}u&&(v.src=u,v.style.display="",v.onerror=()=>{v.style.display="none"}),m.textContent=i,m.title=i,m.style.display=""}if(c&&b){const u=a.querySelector(".tab-header"),f=document.createElement("span");f.className="group-pill",f.textContent=b,f.style.cssText=`background-color:${c};opacity:0.4;color:white;font-size:10px;font-weight:700;padding:2px 6px;border-radius:40px;margin-left:8px;white-space:nowrap;`,u.appendChild(f)}if(!t.sessionId&&!t.isWebSearch){const u=t.hasMedia||!1,f=t.audible||!1,w=t.mutedInfo?.muted||!1,fe=u||f||w;if(u&&d.add("has-media"),f&&d.add("is-audible"),w&&d.add("is-muted"),T.dataset.tabId=String(t.id),fe){const P=Y("tab-play-btn visible","play-pause",f?ge:me,f?"Pause tab":"Play tab");P.dataset.tabId=String(t.id),f&&P.classList.add("playing"),g.appendChild(P);const H=Y("tab-mute-btn visible","mute",w?ve:we,w?"Unmute tab":"Mute tab");H.dataset.tabId=String(t.id),w&&H.classList.add("muted"),g.appendChild(H)}}else g.style.display="none",T.style.display="none";return a}const oe=document.createElement("template");oe.innerHTML='<div class="favicon-tile"><img class="favicon-large" loading="lazy" decoding="async"><div class="favicon-letter" style="display:none;"></div></div>';function ye(t){const o=oe.content.cloneNode(!0).firstElementChild,a=o.querySelector(".favicon-large"),n=o.querySelector(".favicon-letter");let i=t.favIconUrl;if(!i&&t.url)try{const s=new URL(chrome.runtime.getURL("/_favicon/"));s.searchParams.set("pageUrl",t.url),s.searchParams.set("size","32"),i=s.toString()}catch{}return i?(a.src=i,a.onerror=()=>{a.style.display="none",n.textContent=(t.title||"T")[0].toUpperCase(),n.style.display=""}):(a.style.display="none",n.textContent=(t.title||"T")[0].toUpperCase(),n.style.display=""),o}function z(t){try{const r=e.domCache.grid;if(!r)return;r.querySelectorAll(".tab-card.selected").forEach(n=>{n.classList.remove("selected"),n.setAttribute("aria-selected","false")});const a=r.querySelector(`.tab-card[data-tab-index="${e.selectedIndex}"]`);if(!a)return;a.classList.add("selected"),a.setAttribute("aria-selected","true"),r.setAttribute("aria-activedescendant",a.id||`tab-card-${e.selectedIndex}`),a.id||(a.id=`tab-card-${e.selectedIndex}`),t&&requestAnimationFrame(()=>{a.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})})}catch(r){console.error("[Tab Flow] Error enforcing selection:",r)}}function ne(){try{if(!e.domCache.grid)return;if(e.filteredTabs&&e.filteredTabs.length>50){const{startIndex:r,endIndex:o}=e.virtualScroll;(e.selectedIndex<r||e.selectedIndex>=o)&&E(e.filteredTabs)}z(!0)}catch(t){console.error("[Tab Flow] Error in updateSelection:",t)}}function ke(){e.intersectionObserver&&e.intersectionObserver.disconnect();const t=new IntersectionObserver(a=>{a.forEach(n=>{if(!n.isIntersecting)return;const i=n.target;i instanceof HTMLImageElement&&i.dataset.src&&!i.src&&(i.src=i.dataset.src,t.unobserve(i))})},{rootMargin:"100px"});e.intersectionObserver=t;const r=e.domCache.grid;if(!r)return;r.querySelectorAll("img[data-src]").forEach(a=>t.observe(a))}function Te(t){const r=e.domCache.grid;if(!r)return;r.innerHTML="",r.className="tab-flow-grid search-mode";const o=document.createElement("div");o.className="history-view",e.history.active=!0,e.history.backEls=[],e.history.forwardEls=[];const a=document.createElement("div");a.className="history-column";const n=document.createElement("div");if(n.className="history-column-header",n.textContent="â† BACK",a.appendChild(n),t.back&&t.back.length>0){const l=document.createElement("div");l.className="history-items-container",t.back.forEach((d,c)=>{const b=J(d,-(c+1));b.dataset.column="back",b.dataset.index=String(c),l.appendChild(b),e.history.backEls.push(b)}),a.appendChild(l)}else{const l=document.createElement("div");l.className="tab-flow-empty",l.textContent="No back history",l.style.padding="20px",l.style.textAlign="center",l.style.color="var(--text-muted)",a.appendChild(l)}const i=document.createElement("div");i.className="history-column";const s=document.createElement("div");if(s.className="history-column-header",s.textContent="FORWARD â†’",i.appendChild(s),t.forward&&t.forward.length>0){const l=document.createElement("div");l.className="history-items-container",t.forward.forEach((d,c)=>{const b=J(d,c+1);b.dataset.column="forward",b.dataset.index=String(c),l.appendChild(b),e.history.forwardEls.push(b)}),i.appendChild(l)}else{const l=document.createElement("div");l.className="tab-flow-empty",l.textContent="No forward history",l.style.padding="20px",l.style.textAlign="center",l.style.color="var(--text-muted)",i.appendChild(l)}o.appendChild(a),o.appendChild(i),r.appendChild(o),e.history.backEls.length>0?(e.history.column="back",e.history.index=0):e.history.forwardEls.length>0&&(e.history.column="forward",e.history.index=0),A()}function J(t,r){const o=typeof t=="string"?t:t.url,a=typeof t=="string"?t:t.title||t.url,n=document.createElement("div");n.className="history-item",n.tabIndex=0,n.dataset.delta=String(r),n.onclick=()=>{window.history.go(r),p()},n.onkeydown=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),window.history.go(r),p())};const i=document.createElement("img");i.className="history-favicon";try{const c=new URL(chrome.runtime.getURL("/_favicon/"));c.searchParams.set("pageUrl",o),c.searchParams.set("size","16"),i.src=c.toString()}catch{}const s=document.createElement("div");s.className="history-item-content";const l=document.createElement("div");l.className="history-item-title",l.textContent=a,l.title=a;const d=document.createElement("div");d.className="history-item-url";try{const c=new URL(o);d.textContent=c.hostname+c.pathname}catch{d.textContent=o}return d.title=o,s.appendChild(l),s.appendChild(d),n.appendChild(i),n.appendChild(s),n}function A(){const t=e.history.backEls||[],r=e.history.forwardEls||[];for(const i of t)i.classList.remove("selected");for(const i of r)i.classList.remove("selected");const o=e.history.column==="forward"?r:t;if(!o.length)return;const a=Math.min(Math.max(0,e.history.index),o.length-1);e.history.index=a;const n=o[a];n&&(n.classList.add("selected"),n.scrollIntoView({block:"nearest"}))}function Ee(){const t=e.history.backEls||[],r=e.history.forwardEls||[],a=(e.history.column==="forward"?r:t)[e.history.index];if(!a)return;const n=Number(a.dataset.delta);Number.isFinite(n)&&(window.history.go(n),p())}function Ce(t){return{grey:"#bdc1c6",blue:"#8ab4f8",red:"#f28b82",yellow:"#fdd663",green:"#81c995",pink:"#ff8bcb",purple:"#c58af9",cyan:"#78d9ec",orange:"#fcad70"}[t]||t}function Ie(t){try{const r=t.target;if(r.dataset.action==="close"||r.classList.contains("tab-close-btn")){t.stopPropagation();const n=parseInt(r.dataset.tabId||r.parentElement.dataset.tabId||"0"),i=parseInt(r.dataset.tabIndex||r.parentElement.dataset.tabIndex||"0");n&&!Number.isNaN(n)&&$(n,i);return}if(r.dataset.action==="mute"||r.closest(".tab-mute-btn")){t.stopPropagation();const n=r.closest(".tab-mute-btn"),i=parseInt(n.dataset.tabId||"0");i&&!Number.isNaN(i)&&Ne(i,n);return}if(r.dataset.action==="play-pause"||r.closest(".tab-play-btn")){t.stopPropagation();const n=r.closest(".tab-play-btn"),i=parseInt(n.dataset.tabId||"0");i&&!Number.isNaN(i)&&Ae(i,n);return}const o=r.closest(".tab-card");if(!o)return;if(e.viewMode==="recent"||o.dataset.recent==="1"){const n=o.dataset.sessionId;n&&q(n);return}if(o.dataset.webSearch==="1"){const n=o.dataset.searchQuery;n&&(window.open(`https://www.google.com/search?q=${encodeURIComponent(n)}`,"_blank"),p());return}const a=parseInt(o.dataset.tabId||"0");a&&!Number.isNaN(a)?_(a):console.error("[Tab Flow] Invalid tab ID in card:",o)}catch(r){console.error("[Tab Flow] Error in handleGridClick:",r)}}function ie(){return((e.domCache?.searchBox&&typeof e.domCache.searchBox.value=="string"?e.domCache.searchBox.value:"")||"").trim().startsWith(";")}function O(t){if(!e.isOverlayVisible)return;if(t.key==="Escape"){t.preventDefault(),t.stopPropagation(),typeof t.stopImmediatePropagation=="function"&&t.stopImmediatePropagation(),p();return}const r=t.target===e.domCache.searchBox||t.composedPath&&e.domCache.searchBox&&t.composedPath().includes(e.domCache.searchBox),o=ie()&&e.history.active,n=o&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"].includes(t.key);if(r&&!n)return;const i=performance.now();if(i-e.lastKeyTime<e.keyThrottleMs){t.preventDefault();return}e.lastKeyTime=i;try{if(o)switch(t.key){case"Enter":t.preventDefault(),Ee();return;case"ArrowDown":{t.preventDefault();const s=e.history.column==="forward"?e.history.forwardEls:e.history.backEls;s.length&&(e.history.index=Math.min(e.history.index+1,s.length-1),A());return}case"ArrowUp":{t.preventDefault(),(e.history.column==="forward"?e.history.forwardEls:e.history.backEls).length&&(e.history.index=Math.max(e.history.index-1,0),A());return}case"ArrowLeft":{t.preventDefault(),e.history.column==="forward"&&e.history.backEls.length&&(e.history.column="back",e.history.index=Math.min(e.history.index,e.history.backEls.length-1),A());return}case"ArrowRight":{t.preventDefault(),e.history.column==="back"&&e.history.forwardEls.length&&(e.history.column="forward",e.history.index=Math.min(e.history.index,e.history.forwardEls.length-1),A());return}}switch(t.key){case"Enter":if(t.preventDefault(),e.filteredTabs.length>0&&e.selectedIndex>=0&&e.selectedIndex<e.filteredTabs.length){const s=e.filteredTabs[e.selectedIndex];if(s)if(s.isWebSearch){const l=(s.searchQuery||"").trim();l&&(window.open(`https://www.google.com/search?q=${encodeURIComponent(l)}`,"_blank"),p())}else e.viewMode==="recent"&&s.sessionId?q(s.sessionId):s.id&&_(s.id)}break;case"Tab":if(t.preventDefault(),e.domCache?.searchBox){const s=e.domCache.searchBox.value.trim();t.shiftKey?I():e.viewMode==="recent"?y():s.length===0?(e.webSearch.active=!e.webSearch.active,e.domCache.searchBox.dispatchEvent(new Event("input",{bubbles:!0})),e.domCache.searchBox.focus()):s.startsWith(";")?y():(window.open(`https://www.google.com/search?q=${encodeURIComponent(s)}`,"_blank"),p())}else t.shiftKey?I():y();break;case"ArrowRight":t.preventDefault(),se();break;case"ArrowLeft":t.preventDefault(),le();break;case"ArrowDown":t.preventDefault(),y();break;case"ArrowUp":t.preventDefault(),I();break;case"Delete":if(e.viewMode!=="recent"&&e.filteredTabs.length>0&&e.selectedIndex>=0&&e.selectedIndex<e.filteredTabs.length){t.preventDefault();const s=e.filteredTabs[e.selectedIndex];s?.id&&$(s.id,e.selectedIndex)}break;case"g":case"G":if(t.altKey&&(t.preventDefault(),e.viewMode!=="recent"&&e.filteredTabs.length>0&&e.selectedIndex>=0&&e.selectedIndex<e.filteredTabs.length)){const s=e.filteredTabs[e.selectedIndex];s?.id&&Fe(s.id)}break}}catch(s){console.error("[Tab Flow] Error in handleKeyDown:",s)}}function R(){}function Le(t){try{if(ie()&&e.history.active&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"].includes(t.key)){t.preventDefault();return}if(["Delete","Tab","ArrowDown","ArrowUp","ArrowRight","ArrowLeft","Enter"].includes(t.key)){const n=performance.now();if(n-e.lastKeyTime<e.keyThrottleMs){t.preventDefault();return}e.lastKeyTime=n}if(t.key==="."&&(t.target.value||"").length===0){t.preventDefault(),e.viewMode==="recent"?G():de();return}if(t.key==="Backspace"){const n=t.target.value||"";if(n.length===0&&e.webSearch.active){t.preventDefault(),e.webSearch.active=!1,e.domCache?.searchBox&&e.domCache.searchBox.dispatchEvent(new Event("input",{bubbles:!0}));return}if(n.length===0&&e.viewMode==="recent"){t.preventDefault(),G();return}return}if(t.key==="Delete"){if(t.preventDefault(),e.viewMode!=="recent"&&e.filteredTabs.length>0&&e.selectedIndex>=0&&e.selectedIndex<e.filteredTabs.length){const n=e.filteredTabs[e.selectedIndex];n?.id&&$(n.id,e.selectedIndex)}return}if(t.key==="Tab"){t.preventDefault();const i=(t.target.value||"").trim();t.shiftKey?I():e.viewMode==="recent"?y():i.length===0?(e.webSearch.active=!e.webSearch.active,e.domCache?.searchBox&&e.domCache.searchBox.dispatchEvent(new Event("input",{bubbles:!0}))):i.startsWith(";")?y():(window.open(`https://www.google.com/search?q=${encodeURIComponent(i)}`,"_blank"),p());return}if(t.key==="ArrowDown"){t.preventDefault(),y();return}if(t.key==="ArrowUp"){t.preventDefault(),I();return}if(t.key==="ArrowRight"){t.preventDefault(),se();return}if(t.key==="ArrowLeft"){t.preventDefault(),le();return}if(t.key==="Enter"){if(t.preventDefault(),e.filteredTabs.length>0&&e.selectedIndex>=0&&e.selectedIndex<e.filteredTabs.length){const n=e.filteredTabs[e.selectedIndex];e.viewMode==="recent"&&n?.sessionId?q(n.sessionId):n?.isWebSearch?(window.open(`https://www.google.com/search?q=${encodeURIComponent(n.searchQuery)}`,"_blank"),p()):n?.id&&n.id>=0&&_(n.id)}return}}catch(r){console.error("[Tab Flow] Error in handleSearchKeydown:",r)}}function y(){!e.filteredTabs||e.filteredTabs.length===0||(e.selectedIndex++,e.selectedIndex>=e.filteredTabs.length&&(e.selectedIndex=0),ne())}function I(){!e.filteredTabs||e.filteredTabs.length===0||(e.selectedIndex--,e.selectedIndex<0&&(e.selectedIndex=e.filteredTabs.length-1),ne())}function se(){y()}function le(){I()}function Se(){if(e.pageLock)return;const t=document.body;if(!t)return;const r="inert"in t;e.pageLock={bodyPointerEvents:t.style.pointerEvents,bodyUserSelect:t.style.userSelect,bodyInert:r?!!t.inert:!1};try{r&&(t.inert=!0)}catch{}t.style.pointerEvents="none",t.style.userSelect="none"}function X(){if(!e.pageLock)return;const t=document.body;if(!t){e.pageLock=null;return}const r="inert"in t;try{r&&(t.inert=e.pageLock.bodyInert)}catch{}t.style.pointerEvents=e.pageLock.bodyPointerEvents,t.style.userSelect=e.pageLock.bodyUserSelect,e.pageLock=null}function Me(){try{if(document.activeElement&&document.activeElement!==document.body&&document.activeElement!==e.host){const r=document.activeElement;r instanceof HTMLElement&&r.blur()}document.querySelectorAll("iframe").forEach(r=>{try{const o=r.contentDocument?.activeElement;o instanceof HTMLElement&&o.blur()}catch{}})}catch(t){console.debug("[Tab Flow] Error blurring page elements:",t)}}function C(t){return t.target===e.host?!0:(t.composedPath?t.composedPath():[]).some(o=>o===e.host||o===e.shadowRoot||o===e.overlay)}function U(t){e.isOverlayVisible&&(C(t)||(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),t.target instanceof HTMLElement&&t.target.blur(),e.domCache?.searchBox&&e.domCache.searchBox.focus()))}function L(t){if(e.isOverlayVisible&&!C(t)){if(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),e.domCache?.searchBox&&(e.domCache.searchBox.focus(),t.key&&t.key.length===1&&!t.ctrlKey&&!t.altKey&&!t.metaKey)){const r=e.domCache.searchBox,o=r.selectionStart||0,a=r.selectionEnd||0,n=r.value;r.value=n.slice(0,o)+t.key+n.slice(a),r.setSelectionRange(o+1,o+1),r.dispatchEvent(new Event("input",{bubbles:!0}))}return}}function S(t){if(e.isOverlayVisible&&!C(t))if(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),t instanceof InputEvent&&t.type==="beforeinput"&&typeof t.data=="string"&&e.domCache?.searchBox){const r=e.domCache.searchBox;r.focus();const o=r.selectionStart||0,a=r.selectionEnd||0,n=r.value;r.value=n.slice(0,o)+t.data+n.slice(a),r.setSelectionRange(o+t.data.length,o+t.data.length),r.dispatchEvent(new Event("input",{bubbles:!0}))}else e.domCache?.searchBox&&e.domCache.searchBox.focus()}function M(t){e.isOverlayVisible&&(C(t)||(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()))}function ce(t){e.isOverlayVisible&&(C(t)||(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),t.target instanceof HTMLElement&&t.target.blur(),e.domCache?.searchBox&&e.domCache.searchBox.focus()))}function F(t){e.isOverlayVisible&&(C(t)||(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()))}function p(){try{if(!e.isOverlayVisible||e.isClosing)return;e.isClosing=!0,X(),requestAnimationFrame(()=>{e.overlay&&(e.overlay.style.opacity="0"),e.closeTimeout&&clearTimeout(e.closeTimeout),e.closeTimeout=setTimeout(()=>{e.closeTimeout=null,e.isClosing=!1,e.overlay&&(e.overlay.style.display="none"),e.isOverlayVisible=!1,e.focusInterval&&(clearInterval(e.focusInterval),e.focusInterval=null),e.lastFullscreenElement=null,document.removeEventListener("keydown",O,!0),document.removeEventListener("keyup",R,!0),document.removeEventListener("focus",U,!0),document.removeEventListener("focusin",ce,!0),document.removeEventListener("keydown",L,!0),document.removeEventListener("keypress",L,!0),document.removeEventListener("keyup",L,!0),document.removeEventListener("input",S,!0),document.removeEventListener("beforeinput",S,!0),document.removeEventListener("textInput",S,!0),document.removeEventListener("click",F,!0),document.removeEventListener("mousedown",F,!0),document.removeEventListener("compositionstart",M,!0),document.removeEventListener("compositionupdate",M,!0),document.removeEventListener("compositionend",M,!0),e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null),e.resizeObserver&&(e.resizeObserver.disconnect(),e.resizeObserver=null)},200)})}catch(t){console.error("[Tab Flow] Error in closeOverlay:",t),e.isOverlayVisible=!1,e.isClosing=!1,X(),e.focusInterval&&(clearInterval(e.focusInterval),e.focusInterval=null);try{document.removeEventListener("keydown",O,!0),document.removeEventListener("keyup",R,!0),document.removeEventListener("focus",U,!0)}catch{}}}function _(t){try{if(!t||typeof t!="number"){console.error("[Tab Flow] Invalid tab ID:",t);return}try{chrome.runtime.sendMessage({action:"switchToTab",tabId:t},()=>{chrome.runtime.lastError&&console.debug("[Tab Flow] SW not ready:",chrome.runtime.lastError.message)})}catch(r){console.debug("[Tab Flow] sendMessage warn:",r?.message||r)}p()}catch(r){console.error("[Tab Flow] Exception in switchToTab:",r),p()}}function q(t){try{if(!t)return;try{chrome.runtime.sendMessage({action:"restoreSession",sessionId:t},()=>{chrome.runtime.lastError&&console.debug("[Tab Flow] SW not ready (restoreSession):",chrome.runtime.lastError.message)})}catch(r){console.debug("[Tab Flow] sendMessage warn:",r?.message||r)}p()}catch(r){console.error("[Tab Flow] Exception in restoreSession:",r),p()}}function $(t,r){try{if(!t||typeof t!="number"){console.error("[Tab Flow] Invalid tab ID for closing:",t);return}if(!e.currentTabs.some(a=>a&&a.id===t)){console.warn("[Tab Flow] Tab no longer exists:",t),e.filteredTabs=e.filteredTabs.filter(a=>a&&a.id!==t),e.currentTabs=e.currentTabs.filter(a=>a&&a.id!==t),e.selectedIndex>=e.filteredTabs.length&&(e.selectedIndex=Math.max(0,e.filteredTabs.length-1)),e.filteredTabs.length>0?e.filteredTabs.length>50?E(e.filteredTabs):x(e.filteredTabs):p();return}chrome.runtime.sendMessage({action:"closeTab",tabId:t},a=>{if(chrome.runtime.lastError){console.error("[Tab Flow] Error closing tab:",chrome.runtime.lastError.message);return}a?.success&&(e.currentTabs=e.currentTabs.filter(n=>n&&n.id!==t),e.filteredTabs=e.filteredTabs.filter(n=>n&&n.id!==t),e.filteredTabs.length>0?(e.selectedIndex>=e.filteredTabs.length&&(e.selectedIndex=Math.max(0,e.filteredTabs.length-1)),e.filteredTabs.length>50?E(e.filteredTabs):x(e.filteredTabs),e.domCache.searchBox&&e.domCache.searchBox.focus()):p())})}catch(o){console.error("[Tab Flow] Exception in closeTab:",o)}}function Ne(t,r){try{if(!t)return;chrome.runtime.sendMessage({action:"toggleMute",tabId:t},o=>{if(chrome.runtime.lastError){console.error("[Tab Flow] Error toggling mute:",chrome.runtime.lastError);return}if(o&&o.success){const a=o.muted;a?(r.classList.add("muted"),r.title="Unmute tab",r.innerHTML='<svg viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>'):(r.classList.remove("muted"),r.title="Mute tab",r.innerHTML='<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>');const n=e.currentTabs.find(i=>i.id===t);n&&(n.mutedInfo||(n.mutedInfo={muted:!1}),n.mutedInfo.muted=a)}})}catch(o){console.error("[Tab Flow] Exception in toggleMute:",o)}}function Ae(t,r){try{if(!t)return;chrome.runtime.sendMessage({action:"togglePlayPause",tabId:t},o=>{if(chrome.runtime.lastError){console.error("[Tab Flow] Error toggling play/pause:",chrome.runtime.lastError);return}if(o&&o.success){const a=o.playing;a?(r.classList.add("playing"),r.title="Pause tab",r.innerHTML='<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>'):(r.classList.remove("playing"),r.title="Play tab",r.innerHTML='<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>');const n=e.currentTabs.find(i=>i.id===t);n&&(n.isPlaying=a,n.audible=a)}})}catch(o){console.error("[Tab Flow] Exception in togglePlayPause:",o)}}function K(t){e.viewMode=t,e.domCache?.searchBox&&(e.domCache.searchBox.placeholder=t==="recent"?"Search recently closed tabs...":"Search tabs by title or URL..."),e.domCache?.sectionTitle&&(e.domCache.sectionTitle.textContent=t==="recent"?"Recently Closed":"Opened Tabs"),e.domCache?.tabHint&&e.domCache.tabHint.classList.toggle("hidden",t==="recent"),e.domCache?.helpText&&(t==="recent"?e.domCache.helpText.innerHTML=`
        <span><kbd>Alt+Q</kbd> <kbd>â†‘â†“</kbd> Navigate</span>
        <span><kbd>Enter</kbd> Restore</span>
        <span><kbd>Backspace</kbd> Active Tabs</span>
        <span><kbd>Esc</kbd> Exit</span>
      `:e.domCache.helpText.innerHTML=`
        <span><kbd>Alt+Q</kbd> <kbd>â†‘â†“</kbd> Navigate</span>
        <span><kbd>Enter</kbd> Switch Tab</span>
        <span><kbd>Delete</kbd> Close</span>
        <span><kbd>.</kbd> Recent Tabs</span>
        <span><kbd>;</kbd> Tab History</span>
        <span><kbd>Esc</kbd> Exit</span>
      `)}function Fe(t){try{if(!t||typeof t!="number")return;chrome.runtime.sendMessage({action:"createGroup",tabId:t},r=>{if(chrome.runtime.lastError){console.error("[Tab Flow] Error creating group:",chrome.runtime.lastError.message);return}r?.success&&p()})}catch(r){console.error("[Tab Flow] Exception in createGroup:",r)}}function G(){if(e.viewMode==="active")return;K("active"),e.currentTabs=e.activeTabs||[];const t=e.currentTabs;e.filteredTabs=t,e.selectedIndex=0,e.domCache.grid&&(e.domCache.grid.classList.remove("recent-mode"),e.domCache.grid.classList.remove("search-mode")),e.filteredTabs.length>50?E(e.filteredTabs):x(e.filteredTabs),e.domCache.searchBox&&(e.domCache.searchBox.value="",e.domCache.searchBox.focus())}async function de(){if(e.viewMode==="recent")return;K("recent");let t=[];try{t=await new Promise(r=>{try{chrome.runtime.sendMessage({action:"getRecentlyClosed",maxResults:10},o=>{if(chrome.runtime.lastError){console.debug("[Tab Flow] Runtime error:",chrome.runtime.lastError.message),r([]);return}o?.success?r(o.items||[]):r([])})}catch{r([])}})}catch(r){console.debug("[Tab Flow] Failed to load recently closed:",r)}e.recentItems=t.map((r,o)=>({id:void 0,title:r.title,url:r.url,favIconUrl:r.favIconUrl,screenshot:null,sessionId:r.sessionId,index:o})),e.currentTabs=e.recentItems,e.filteredTabs=e.recentItems,e.selectedIndex=0,e.domCache.grid&&e.domCache.grid.classList.add("recent-mode"),x(e.filteredTabs),e.domCache.searchBox&&e.domCache.searchBox.focus()}function Be(){try{if(!window.navigation||typeof window.navigation.entries!="function")return console.log("[Tab Flow] Navigation API not available"),{back:[],forward:[]};const t=window.navigation.entries(),r=window.navigation.currentEntry;if(!t||t.length===0||!r)return console.log("[Tab Flow] No navigation entries available"),{back:[],forward:[]};const o=r.index;console.log("[Tab Flow] Navigation entries:",t.length,"Current index:",o);const a=[];for(let i=o-1;i>=0;i--){const s=t[i];s&&s.url&&a.push({url:s.url,title:Z(s.url)})}const n=[];for(let i=o+1;i<t.length;i++){const s=t[i];s&&s.url&&n.push({url:s.url,title:Z(s.url)})}return console.log("[Tab Flow] Back entries:",a.length,"Forward entries:",n.length),{back:a,forward:n}}catch(t){return console.error("[Tab Flow] Error getting navigation history:",t),{back:[],forward:[]}}}function Z(t){try{const r=new URL(t);let o=r.hostname;if(o.startsWith("www.")&&(o=o.substring(4)),r.pathname&&r.pathname!=="/"){const a=r.pathname.split("/").filter(n=>n).pop();a&&a.length<50&&(o+=" - "+decodeURIComponent(a).replace(/[-_]/g," "))}return o}catch{return t}}const ze=typeof requestIdleCallback<"u"?requestIdleCallback:t=>setTimeout(t,1),Pe=typeof cancelIdleCallback<"u"?cancelIdleCallback:clearTimeout;function He(){let t=null,r=null,o=0;const a=100,n=250,i=50;return s=>{const l=performance.now(),d=l-o,c=e.currentTabs.length>=i;t&&(clearTimeout(t),t=null),r&&(Pe(r),r=null),!c&&d>=a?(o=l,D(s)):t=setTimeout(()=>{c?r=ze(()=>{o=performance.now(),D(s)}):(o=performance.now(),D(s))},c?n:a)}}function D(t){try{const r=t.target,o=r instanceof HTMLInputElement?r.value:e.domCache?.searchBox?.value??"",a=String(o).trim();if(e.domCache?.tabHint){const l=a.length>0||e.viewMode==="recent"||e.webSearch.active;e.domCache.tabHint.classList.toggle("hidden",l)}if(a.startsWith(";")){e.webSearch.active=!1,e.history.active=!0,e.domCache.grid&&(e.domCache.grid.classList.add("search-mode"),e.domCache.grid.classList.remove("recent-mode")),e.domCache.sectionTitle&&(e.domCache.sectionTitle.textContent="Tab History"),e.domCache.helpText&&(e.domCache.helpText.innerHTML=`
            <span><kbd>;</kbd> History Mode</span>
            <span><kbd>â†â†’</kbd> Switch Column</span>
            <span><kbd>â†‘â†“</kbd> Navigate</span>
            <span><kbd>Enter</kbd> Go</span>
            <span><kbd>Backspace</kbd> Exit</span>
            <span><kbd>Esc</kbd> Close</span>
          `);const l=Be();console.log("[Tab Flow] Navigation API history:",l),Te(l);return}if(e.history.active=!1,e.history.backEls=[],e.history.forwardEls=[],e.viewMode!=="recent"&&e.webSearch.active){const l=a,d={title:l?`Search Web for "${l}"`:"Type to search web...",url:l?`https://www.google.com/search?q=${encodeURIComponent(l)}`:"",favIconUrl:"https://www.google.com/favicon.ico",isWebSearch:!0,searchQuery:l};e.filteredTabs=[d],e.selectedIndex=0,e.domCache.grid&&(e.domCache.grid.classList.add("search-mode"),e.domCache.grid.classList.remove("recent-mode")),e.domCache.sectionTitle&&(e.domCache.sectionTitle.textContent="Web Search"),x(e.filteredTabs);return}e.domCache.grid&&e.domCache.grid.classList.remove("search-mode"),e.domCache.sectionTitle&&(e.domCache.sectionTitle.textContent=e.viewMode==="recent"?"Recently Closed":"Opened Tabs");const n=t instanceof InputEvent&&t.inputType==="deleteContentBackward";if(a==="."&&!n){const l=e.domCache?.searchBox;l&&(l.value=""),e.viewMode==="recent"?G():de();return}if(!a){e.filteredTabs=e.currentTabs,e.selectedIndex=0,e.currentTabs.length>50?E(e.currentTabs):x(e.currentTabs);return}const s=e.currentTabs.map(l=>{const d=ee(l.title,a),c=ee(l.url,a),b=d.score>c.score?d:c;return{tab:l,match:b.match,score:b.score}}).filter(l=>l.match).sort((l,d)=>d.score-l.score).map(l=>l.tab);e.filteredTabs=s,e.selectedIndex=0,s.length>50?E(s):x(s)}catch(r){console.error("[Tab Flow] Error in handleSearch:",r),e.filteredTabs=e.currentTabs,e.selectedIndex=0,x(e.currentTabs)}}function ee(t,r){if(!t)return{match:!1,score:0};const o=String(t).toLowerCase(),a=String(r??"").toLowerCase();if(a.length===0)return{match:!0,score:1};if(o===a)return{match:!0,score:100};if(o.startsWith(a))return{match:!0,score:80+a.length/o.length*10};if(o.includes(a))return{match:!0,score:50+a.length/o.length*10};let n=0,i=0,s=0,l=0,d=-1;for(;n<o.length&&i<a.length;){if(o[n]===a[i]){d===-1&&(d=n);let c=1;l>0&&(c+=2+l),(n===0||o[n-1]===" "||o[n-1]==="."||o[n-1]==="/"||o[n-1]==="-")&&(c+=3),s+=c,l++,i++}else l=0;n++}return i<a.length?{match:!1,score:0}:(s-=(o.length-a.length)*.1,d>0&&(s-=d*.5),{match:!0,score:Math.max(1,s)})}let W="grid";try{chrome.storage.local.get(["TabFlowViewMode"],t=>{if(!chrome.runtime.lastError&&t.TabFlowViewMode){const r=t.TabFlowViewMode;(r==="grid"||r==="list")&&(W=r)}})}catch{}function De(){return W}function Ve(t){W=t;try{chrome.storage.local.set({TabFlowViewMode:t})}catch{}}const te=new WeakSet;function Oe(t){if(te.has(t))return;te.add(t);const r=a=>{e.isOverlayVisible&&C(a)&&(a.stopPropagation(),typeof a.stopImmediatePropagation=="function"&&a.stopImmediatePropagation())},o=["keydown","keyup","keypress","beforeinput","input","textInput","compositionstart","compositionupdate","compositionend","click","mousedown","mouseup","pointerdown","pointerup","contextmenu"];for(const a of o)t.addEventListener(a,r)}function Re(){const t=document,r=document.fullscreenElement||t.webkitFullscreenElement;return r?r.tagName==="VIDEO"?r.parentElement||null:r:null}function ue(){if(!e.host)return;const r=Re()||document.documentElement||document.body;if(r)try{e.host.parentNode,r.appendChild(e.host)}catch{}}function Ue(){try{if(!e.host||!e.host.isConnected){e.shadowRoot=null,e.styleElement=null;const t=document.getElementById(j);if(t)e.host=t;else{const r=document.createElement("tab-flow-mount");r.id=j,r.style.cssText=`
        all: initial !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 0 !important;
        height: 0 !important;
        min-width: 0 !important;
        min-height: 0 !important;
        max-width: 0 !important;
        max-height: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        border: none !important;
        overflow: visible !important;
        z-index: 2147483647 !important;
        pointer-events: auto !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        contain: layout style !important;
        isolation: isolate !important;
      `,(document.documentElement||document.body).appendChild(r),e.host=r}}if(ue(),e.shadowRoot||(e.host.shadowRoot?e.shadowRoot=e.host.shadowRoot:e.shadowRoot=e.host.attachShadow({mode:"open"})),!e.styleElement||!e.shadowRoot.contains(e.styleElement)){const t=document.createElement("style");t.textContent=pe,e.shadowRoot.appendChild(t),e.styleElement=t}return Oe(e.shadowRoot),e.shadowRoot}catch(t){return console.error("[Tab Flow] Failed to initialize shadow root:",t),null}}function Ge(){if(e.overlay)return;const t=Ue();if(!t)return;const r=document.createElement("div");r.id="visual-tab-flow-overlay",r.className="tab-flow-overlay",r.style.willChange="opacity";const o=document.createElement("div");o.className="tab-flow-backdrop",r.appendChild(o);const a=document.createElement("div");a.className="tab-flow-container",a.style.transform="translate3d(0, 0, 0)";const n=document.createElement("div");n.className="tab-flow-search-row";const i=document.createElement("div");i.className="tab-flow-search-wrap";const s=document.createElement("input");s.type="text",s.className="tab-flow-search",s.placeholder="Search tabs by title or URL...",s.autocomplete="off";const l=document.createElement("div");l.className="search-icon",l.innerHTML=`<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="3" y="3" width="7" height="7" rx="1"></rect>
    <rect x="14" y="3" width="7" height="7" rx="1"></rect>
    <rect x="3" y="14" width="7" height="7" rx="1"></rect>
    <rect x="14" y="14" width="7" height="7" rx="1"></rect>
  </svg>`;const d=document.createElement("div");d.className="search-tab-hint",d.innerHTML="<kbd>Tab</kbd> Search Google",i.appendChild(l),i.appendChild(s),i.appendChild(d),n.appendChild(i),a.appendChild(n);const c=document.createElement("div");c.className="tab-flow-section-header";const b=document.createElement("span");b.className="tab-flow-section-title",b.textContent="Opened Tabs";const h=document.createElement("div");h.className="tab-flow-view-toggle";const k=De(),m=document.createElement("button");m.type="button",m.className=`view-toggle-btn ${k==="grid"?"active":""}`,m.dataset.view="grid",m.title="Grid View",m.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <rect x="3" y="3" width="7" height="7" rx="1"></rect>
    <rect x="14" y="3" width="7" height="7" rx="1"></rect>
    <rect x="3" y="14" width="7" height="7" rx="1"></rect>
    <rect x="14" y="14" width="7" height="7" rx="1"></rect>
  </svg>`;const v=document.createElement("button");v.type="button",v.className=`view-toggle-btn ${k==="list"?"active":""}`,v.dataset.view="list",v.title="List View",v.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <line x1="3" y1="6" x2="21" y2="6"></line>
    <line x1="3" y1="12" x2="21" y2="12"></line>
    <line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>`,h.appendChild(m),h.appendChild(v),c.appendChild(b),c.appendChild(h),a.appendChild(c);const g=document.createElement("div");g.className=`tab-flow-grid ${k==="list"?"list-view":""}`,g.id="tab-flow-grid",g.setAttribute("role","listbox"),g.setAttribute("aria-label","Open tabs"),g.style.transform="translate3d(0, 0, 0)",a.appendChild(g);const T=document.createElement("div");T.className="tab-flow-help",T.innerHTML=`
      <span><kbd>Alt+Q</kbd> <kbd>â†‘â†“</kbd> Navigate</span>
     <span><kbd>â†µ</kbd>Switch</span>
     <span><kbd>Del</kbd>Close</span>
     <span><kbd>.</kbd>Recent</span>
     <span><kbd>;</kbd>History</span>
     <span><kbd>Esc</kbd>Exit</span>
   `,a.appendChild(T),r.appendChild(a),s.addEventListener("input",He()),s.addEventListener("keydown",Le),o.addEventListener("click",p),g.addEventListener("click",Ie),h.addEventListener("click",u=>{const f=u.target.closest(".view-toggle-btn");if(!f)return;const w=f.dataset.view;w&&(m.classList.toggle("active",w==="grid"),v.classList.toggle("active",w==="list"),g.classList.toggle("list-view",w==="list"),Ve(w))}),e.overlay=r,e.domCache={grid:g,searchBox:s,container:a,searchWrap:i,helpText:T,sectionTitle:b,tabHint:d},t.appendChild(r),console.log("[PERF] Overlay created with GPU acceleration and event delegation")}function _e(t,r,o=[]){performance.now(),console.log(`[Tab Flow] Opening with ${t.length} tabs and ${o.length} groups`);const a=document;if(e.lastFullscreenElement=document.fullscreenElement||a.webkitFullscreenElement||null,e.isOverlayVisible&&!e.isClosing)return;if(e.closeTimeout&&(clearTimeout(e.closeTimeout),e.closeTimeout=null),e.isClosing=!1,e.isOverlayVisible=!0,e.webSearch.active=!1,e.history.active=!1,Ge(),!e.overlay){e.isOverlayVisible=!1;return}const n=e.overlay;ue(),n.style.display="flex",n.style.opacity="0",e.activeTabs=t,e.currentTabs=t,e.groups=o,e.filteredTabs=t,K("active"),e.domCache?.grid&&(e.domCache.grid.classList.remove("search-mode"),e.domCache.grid.classList.remove("recent-mode"));const i=t.findIndex(s=>s.id===r);t.length>1&&i===0?e.selectedIndex=1:(i>0,e.selectedIndex=0),e.filteredTabs.length>50?(console.log("[PERF] Using virtual scrolling for",e.filteredTabs.length,"tabs"),E(e.filteredTabs)):x(e.filteredTabs),n.style.display="flex",n.style.opacity="0",e.isOverlayVisible=!0,Se(),Me(),e.domCache.searchBox&&(e.domCache.searchBox.value="",e.domCache.searchBox.focus()),e.domCache.grid&&(e.domCache.grid.scrollTop=0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.overlay&&(e.overlay.style.opacity="1")})}),document.addEventListener("keydown",O,!0),document.addEventListener("keyup",R,!0),document.addEventListener("focus",U,!0),document.addEventListener("focusin",ce,!0),document.addEventListener("keydown",L,!0),document.addEventListener("keypress",L,!0),document.addEventListener("keyup",L,!0),document.addEventListener("input",S,!0),document.addEventListener("beforeinput",S,!0),document.addEventListener("textInput",S,!0),document.addEventListener("click",F,!0),document.addEventListener("mousedown",F,!0),document.addEventListener("compositionstart",M,!0),document.addEventListener("compositionupdate",M,!0),document.addEventListener("compositionend",M,!0),e.focusInterval&&clearInterval(e.focusInterval),e.focusInterval=setInterval(()=>{e.isOverlayVisible&&e.domCache.searchBox&&document.activeElement!==e.domCache.searchBox&&e.domCache.searchBox.focus()},100)}console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");console.log("Visual Tab Flow - Content Script Loaded");console.log("Features: Virtual Scrolling, Event Delegation, GPU Acceleration");console.log("Target: <16ms interactions, 60fps, lazy loading");console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");function N(){try{const t=document.querySelectorAll("video, audio"),r=t.length>0;let o=!1;if(r){for(const a of t)if(!a.paused&&!a.ended&&a.readyState>2){o=!0;break}}r&&chrome.runtime.sendMessage({action:"reportMediaPresence",hasMedia:!0,isPlaying:o},()=>{chrome.runtime.lastError})}catch{}}function qe(){try{document.addEventListener("play",()=>N(),!0),document.addEventListener("pause",()=>N(),!0),document.addEventListener("ended",()=>N(),!0)}catch{}}qe();document.readyState==="complete"?N():window.addEventListener("load",N);let V=null;const $e=new MutationObserver(t=>{if(t.some(o=>Array.from(o.addedNodes).some(a=>a.nodeName==="VIDEO"||a.nodeName==="AUDIO"||a instanceof HTMLElement&&a.querySelector("video, audio")))){if(V)return;V=setTimeout(()=>{N(),V=null},2e3)}});try{$e.observe(document.body,{childList:!0,subtree:!0})}catch{}const be=()=>{e.isOverlayVisible&&p()};window.addEventListener("blur",be);document.addEventListener("visibilitychange",()=>{document.hidden&&be()});chrome.runtime.onMessage.addListener((t,r,o)=>{if(t.action==="showTabFlow"){if(e.isOverlayVisible)return y(),z(!0),o({success:!0,advanced:!0}),!0;_e(t.tabs,t.activeTabId,t.groups),o({success:!0})}return!0});export{$e as mediaObserver};
