console.log("[TAB SWITCHER] Content script messaging module loaded");const e={overlay:null,currentTabs:[],activeTabs:[],filteredTabs:[],selectedIndex:0,isOverlayVisible:!1,viewMode:"active",recentItems:[],groups:[],collapsedGroups:new Set,host:null,shadowRoot:null,styleElement:null,lastFullscreenElement:null,domCache:{grid:null,searchBox:null,container:null,searchWrap:null,sectionTitle:null,tabHint:null},virtualScroll:{startIndex:0,endIndex:0,visibleCount:20,bufferCount:5},lastKeyTime:0,keyThrottleMs:16,resizeObserver:null,intersectionObserver:null,focusInterval:null,closeTimeout:null,isClosing:!1,pageLock:null,history:{active:!1,backEls:[],forwardEls:[],column:"back",index:0},webSearch:{active:!1}},he='*,*:before,*:after{box-sizing:border-box;margin:0;padding:0}:host{all:initial!important;display:contents!important;--bg-overlay: rgba(0, 0, 0, .3);--bg-surface: #181818;--bg-glass: #303030;--bg-glass-hover: #333333;--border-subtle: rgba(255, 255, 255, .1);--border-hover: rgba(255, 255, 255, .15);--border-active: rgba(255, 255, 255, .25);--text-primary: #ffffff;--text-secondary: #a0a0a0;--text-muted: #666666;--accent: #ffffff;--accent-light: #e0e0e0;--accent-glow: rgba(255, 255, 255, .1);--card-bg: #282828;--card-hover: #2f2f2f;--card-selected: #3a3a3a;--danger: #ff6b6b;--success: #59d499;--radius-3xl: 12px;--radius-2xl: 10px;--radius-xl: 8px;--radius-lg: 8px;--radius-md: 6px;--radius-sm: 5px;--radius-xs: 4px;--radius-full: 9999px;--shadow-xl: 0 40px 100px -12px rgba(0, 0, 0, .9), 0 0 0 1px rgba(255, 255, 255, .08);--shadow-card: 0 8px 24px rgba(0, 0, 0, .35);--font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Inter", sans-serif;--transition-fast: .1s ease;--transition-smooth: .15s cubic-bezier(.2, 0, 0, 1)}@media(prefers-color-scheme:light){:host{--bg-overlay: rgba(0, 0, 0, .25);--bg-surface: #ffffff;--bg-glass: #f5f5f5;--bg-glass-hover: #ebebeb;--border-subtle: rgba(0, 0, 0, .1);--border-hover: rgba(0, 0, 0, .15);--border-active: rgba(0, 0, 0, .25);--text-primary: #000000;--text-secondary: #666666;--text-muted: #999999;--accent: #000000;--accent-light: #333333;--accent-glow: rgba(0, 0, 0, .08);--card-bg: #f8f8f8;--card-hover: #f0f0f0;--card-selected: #e5e5e5;--shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, .15), 0 0 0 1px rgba(0, 0, 0, .06);--shadow-card: 0 2px 8px rgba(0, 0, 0, .08)}}.tab-switcher-overlay{position:fixed;inset:0;z-index:2147483647;display:none;align-items:center;justify-content:center;padding:20px;font-family:var(--font-family);font-size:14px;line-height:1.5;color:var(--text-primary);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;pointer-events:auto;overscroll-behavior:contain}.tab-switcher-backdrop{position:absolute;inset:0;background:var(--bg-overlay);backdrop-filter:blur(40px) saturate(180%);-webkit-backdrop-filter:blur(40px) saturate(180%);animation:backdropFadeIn .2s cubic-bezier(.2,0,0,1)}.tab-switcher-container{position:relative;width:750px;max-width:94vw;max-height:68vh;background:var(--bg-surface);border:1px solid var(--border-subtle);border-radius:var(--radius-3xl);box-shadow:var(--shadow-xl);display:flex;flex-direction:column;padding:0;overflow:hidden;animation:containerSlideIn .2s cubic-bezier(.2,0,0,1)}.tab-switcher-search-row{display:flex;align-items:center;gap:0;padding:0;flex-shrink:0;border-bottom:1px solid var(--border-subtle);background:transparent}.tab-switcher-search-wrap{flex:1;position:relative;display:flex;align-items:center}.tab-switcher-search{width:100%;background:transparent;border:none;border-radius:0;padding:22px 24px 22px 56px;font-size:17px;font-weight:400;color:var(--text-primary);outline:none;transition:none;letter-spacing:-.01em;caret-color:var(--accent)}.tab-switcher-search:focus{background:transparent;border-color:transparent;box-shadow:none}.tab-switcher-search::placeholder{color:var(--text-muted);font-weight:400}.search-icon{position:absolute;left:18px;color:var(--text-muted);pointer-events:none;display:flex;align-items:center;transition:color var(--transition-fast)}.tab-switcher-search:focus~.search-icon,.tab-switcher-search-wrap:focus-within .search-icon{color:var(--text-muted);transform:none}.search-tab-hint{position:absolute;right:16px;display:flex;align-items:center;gap:6px;color:var(--text-muted);font-size:12px;pointer-events:none;opacity:1;transition:opacity var(--transition-fast)}.search-tab-hint kbd{display:inline-flex;align-items:center;justify-content:center;min-width:22px;height:20px;padding:0 6px;background:var(--bg-glass);border:1px solid var(--border-subtle);border-radius:var(--radius-xs);font-size:11px;font-weight:500;font-family:inherit;color:var(--text-secondary)}.search-tab-hint.hidden{opacity:0}.tab-switcher-section-header{display:flex;align-items:center;justify-content:space-between;padding:10px 16px 2px;flex-shrink:0}.tab-switcher-section-title{font-size:12px;font-weight:600;color:var(--text-muted);text-transform:uppercase;letter-spacing:.05em}.tab-switcher-view-toggle{display:flex;align-items:center;gap:2px;background:var(--bg-glass);border-radius:var(--radius-sm);padding:2px}.view-toggle-btn{display:flex;align-items:center;justify-content:center;width:28px;height:24px;border:none;background:transparent;color:var(--text-muted);border-radius:var(--radius-xs);cursor:pointer;transition:all var(--transition-fast)}.view-toggle-btn:hover{color:var(--text-secondary);background:var(--bg-glass-hover)}.view-toggle-btn.active{background:var(--bg-glass-hover);color:var(--text-primary)}.view-toggle-btn svg{width:14px;height:14px}.recent-back-btn{position:absolute;left:8px;z-index:10;width:28px;height:28px;display:flex;align-items:center;justify-content:center;border:none;background:transparent;color:var(--text-secondary);border-radius:var(--radius-sm);cursor:pointer;font-size:16px;transition:all var(--transition-fast)}.recent-back-btn:hover{background:var(--bg-glass-hover);color:var(--text-primary);transform:none}.tab-switcher-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px;overflow-y:auto;overflow-x:hidden;padding:12px;min-height:180px;scroll-behavior:smooth;overscroll-behavior:contain}.tab-switcher-grid.list-view{display:flex;flex-direction:column;gap:12px}.tab-switcher-grid.list-view .tab-card{width:100%;height:auto;min-height:52px;flex-direction:row;align-items:center;padding:10px 14px;gap:12px}.tab-switcher-grid.list-view .tab-card:hover{transform:none}.tab-switcher-grid.list-view .tab-card.selected{transform:none!important}.tab-switcher-grid.list-view .tab-thumbnail{flex:0 0 36px;height:36px;width:36px;min-height:36px;border-radius:var(--radius-sm)}.tab-switcher-grid.list-view .tab-info{flex:1;padding:0;min-width:0}.tab-switcher-grid.list-view .tab-title{font-size:14px}.tab-switcher-grid.list-view .tab-url{padding-left:0;font-size:12px}.tab-switcher-grid.list-view .tab-close-btn{position:relative;top:auto;right:auto;opacity:0;width:24px;height:24px;flex-shrink:0}.tab-switcher-grid.list-view .tab-card:hover .tab-close-btn{opacity:1}.tab-switcher-grid.list-view .tab-media-controls{position:relative;bottom:auto;right:auto;opacity:1;display:flex;margin-right:8px;flex-shrink:0}.tab-switcher-grid.list-view .tab-play-btn,.tab-switcher-grid.list-view .tab-mute-btn{opacity:.6}.tab-switcher-grid.list-view .tab-card:hover .tab-play-btn,.tab-switcher-grid.list-view .tab-card:hover .tab-mute-btn,.tab-switcher-grid.list-view .tab-play-btn.playing,.tab-switcher-grid.list-view .tab-play-btn.visible,.tab-switcher-grid.list-view .tab-mute-btn.muted,.tab-switcher-grid.list-view .tab-mute-btn.visible,.tab-switcher-grid.list-view .tab-card.has-media .tab-play-btn,.tab-switcher-grid.list-view .tab-card.has-media .tab-mute-btn,.tab-switcher-grid.list-view .tab-card.is-audible .tab-play-btn,.tab-switcher-grid.list-view .tab-card.is-audible .tab-mute-btn,.tab-switcher-grid.list-view .tab-card.is-muted .tab-mute-btn{opacity:1}.tab-switcher-grid.recent-mode,.tab-switcher-grid.search-mode{display:flex;flex-direction:column;gap:12px;min-height:auto}.tab-switcher-grid.recent-mode .tab-media-controls,.tab-switcher-grid.search-mode .tab-media-controls{position:relative;bottom:auto;right:auto;opacity:1;display:flex;margin-right:8px;flex-shrink:0}.tab-switcher-grid.recent-mode .tab-play-btn,.tab-switcher-grid.recent-mode .tab-mute-btn,.tab-switcher-grid.search-mode .tab-play-btn,.tab-switcher-grid.search-mode .tab-mute-btn{opacity:.6}.tab-switcher-grid.recent-mode .tab-card:hover .tab-play-btn,.tab-switcher-grid.recent-mode .tab-card:hover .tab-mute-btn,.tab-switcher-grid.search-mode .tab-card:hover .tab-play-btn,.tab-switcher-grid.search-mode .tab-card:hover .tab-mute-btn,.tab-switcher-grid.recent-mode .tab-card.has-media .tab-play-btn,.tab-switcher-grid.recent-mode .tab-card.has-media .tab-mute-btn,.tab-switcher-grid.search-mode .tab-card.has-media .tab-play-btn,.tab-switcher-grid.search-mode .tab-card.has-media .tab-mute-btn,.tab-switcher-grid.recent-mode .tab-card.is-audible .tab-play-btn,.tab-switcher-grid.recent-mode .tab-card.is-audible .tab-mute-btn,.tab-switcher-grid.search-mode .tab-card.is-audible .tab-play-btn,.tab-switcher-grid.search-mode .tab-card.is-audible .tab-mute-btn{opacity:1}.tab-switcher-grid::-webkit-scrollbar{width:6px}.tab-switcher-grid::-webkit-scrollbar-track{background:transparent;margin:4px 0}.tab-switcher-grid::-webkit-scrollbar-thumb{background:#ffffff26;border-radius:100px;transition:background .2s ease}.tab-switcher-grid::-webkit-scrollbar-thumb:hover{background:#ffffff40}.tab-switcher-grid::-webkit-scrollbar-thumb:active{background:#ffffff59}.tab-switcher-grid{scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.15) transparent}@media(prefers-color-scheme:light){.tab-switcher-grid::-webkit-scrollbar-thumb{background:#0000001f}.tab-switcher-grid::-webkit-scrollbar-thumb:hover{background:#0003}.tab-switcher-grid::-webkit-scrollbar-thumb:active{background:#0000004d}.tab-switcher-grid{scrollbar-color:rgba(0,0,0,.12) transparent}}.tab-switcher-empty{grid-column:1 / -1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px 24px;color:var(--text-muted);font-size:14px;text-align:center}.tab-card{background:var(--card-bg);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);overflow:hidden;cursor:pointer;position:relative;display:flex;flex-direction:column;height:160px;transition:all var(--transition-fast);box-shadow:none;contain:content}.tab-card:hover{transform:translateY(-2px);border-color:var(--border-hover);background:var(--card-hover);box-shadow:0 4px 12px #00000026}.tab-card.selected{border-color:var(--accent)!important;border-width:2px!important;background:var(--card-selected)!important;box-shadow:0 0 0 2px var(--accent-glow),0 4px 12px #0003!important;transform:translateY(-3px)!important;z-index:50!important}.tab-card.selected:before{content:"";position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.03) 0%,transparent 100%);pointer-events:none;z-index:0;animation:none}@keyframes selection-pulse{0%{opacity:.4}to{opacity:.8}}.tab-card.pinned:after{content:"ðŸ“Œ";position:absolute;top:8px;left:8px;font-size:12px;z-index:5;filter:drop-shadow(0 1px 2px rgba(0,0,0,.5))}.tab-audio-indicator{position:absolute;bottom:8px;right:8px;width:24px;height:24px;border-radius:50%;background:#000000b3;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;color:#fff;z-index:5;opacity:.9;box-shadow:0 2px 4px #0003}.tab-audio-indicator svg{width:14px;height:14px;fill:currentColor}.tab-audio-indicator.muted{color:#ff5252}.tab-card[data-web-search="1"]{width:100%!important;height:60px!important;flex-direction:row!important;align-items:center!important;padding:0 18px!important;gap:14px!important}.tab-card[data-web-search="1"]:hover{transform:translateY(-2px)}.tab-thumbnail{flex:1;min-height:0;background:linear-gradient(180deg,#00000005,#00000014);position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}.tab-card[data-web-search="1"] .tab-thumbnail{flex:0 0 36px;height:36px;width:36px;border-radius:var(--radius-md);background:var(--bg-glass)}.screenshot-img{width:100%;height:100%;object-fit:cover;object-position:top center;opacity:.95;transition:all var(--transition-smooth)}.tab-card:hover .screenshot-img,.tab-card.selected .screenshot-img{opacity:1;transform:scale(1.04)}.favicon-tile{width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--bg-glass) 0%,transparent 100%)}.tab-card[data-web-search="1"] .favicon-tile{background:transparent}.favicon-large{width:44px;height:44px;object-fit:contain;border-radius:var(--radius-sm);transition:transform var(--transition-smooth)}.tab-card:hover .favicon-large{transform:scale(1.08)}.tab-card[data-web-search="1"] .favicon-large{width:26px;height:26px}.favicon-letter{width:48px;height:48px;border-radius:var(--radius-md);background:var(--bg-glass-hover);border:1px solid var(--border-subtle);color:var(--text-primary);display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:600;letter-spacing:-.02em;transition:all var(--transition-smooth)}.tab-card:hover .favicon-letter,.tab-card.selected .favicon-letter{transform:scale(1.08);border-color:var(--accent);background:var(--bg-glass-hover)}.tab-info{padding:12px 14px;background:transparent;position:relative;z-index:1}.tab-card[data-web-search="1"] .tab-info{flex:1!important;padding:0!important;display:flex!important;align-items:center!important}.tab-header{display:flex;align-items:center;gap:10px;margin-bottom:4px}.tab-card[data-web-search="1"] .tab-header{margin:0!important;width:100%!important}.tab-favicon{width:16px;height:16px;opacity:.85;border-radius:3px;flex-shrink:0}.tab-title{font-size:13px;font-weight:500;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;letter-spacing:-.01em}.tab-card.selected .tab-title{color:var(--text-primary);font-weight:700}.tab-card[data-web-search="1"] .tab-title{font-size:15px;font-weight:500}.tab-url{font-size:11px;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-left:26px;letter-spacing:-.01em}.tab-card[data-web-search="1"] .tab-url{display:none}.tab-close-btn{position:absolute;top:10px;right:10px;width:28px;height:28px;border-radius:var(--radius-sm);background:#000000a6;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);color:#fff;border:none;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:300;opacity:0;transform:scale(.8);transition:all var(--transition-smooth);cursor:pointer;z-index:10}.tab-card:hover .tab-close-btn{opacity:1;transform:scale(1)}.tab-close-btn:hover{background:var(--danger);transform:scale(1.1)}.tab-close-btn:active{transform:scale(.95)}.tab-mute-btn.muted{color:#ff5252;background:#000c}.tab-media-controls{position:absolute;bottom:58px;right:12px;display:flex;gap:8px;z-index:10}.tab-play-btn{width:24px;height:24px;border-radius:50%;background:#000000b3;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;color:#fff;opacity:0;border:none;cursor:pointer;transition:all var(--transition-fast);box-shadow:0 2px 4px #0003}.tab-card:hover .tab-play-btn,.tab-play-btn.playing,.tab-play-btn.visible{opacity:.9}.tab-card.has-media .tab-play-btn,.tab-card.is-audible .tab-play-btn{opacity:.85}.tab-play-btn:hover{background:var(--bg-surface);color:var(--text-primary);transform:scale(1.1);opacity:1}.tab-play-btn svg{width:14px;height:14px;fill:currentColor}.tab-play-btn.playing{background:#000c}.tab-mute-btn{position:relative;bottom:auto;right:auto;width:24px;height:24px;border-radius:50%;background:#000000b3;-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;color:#fff;opacity:0;border:none;cursor:pointer;transition:all var(--transition-fast);box-shadow:0 2px 4px #0003}.tab-card:hover .tab-mute-btn,.tab-mute-btn.muted,.tab-mute-btn.visible{opacity:.9}.tab-card.has-media .tab-mute-btn,.tab-card.is-audible .tab-mute-btn,.tab-card.is-muted .tab-mute-btn{opacity:.85}.tab-mute-btn:hover{background:var(--bg-surface);color:var(--text-primary);transform:scale(1.1);opacity:1}.tab-mute-btn svg{width:14px;height:14px;fill:currentColor}.tab-switcher-help{display:flex;align-items:center;gap:0;margin-top:0;padding:10px 16px;border-top:1px solid var(--border-subtle);color:var(--text-muted);font-size:12px;justify-content:center;flex-wrap:nowrap;flex-shrink:0;background:var(--bg-surface);min-height:40px}.tab-switcher-help span{display:inline-flex;align-items:center;gap:5px;padding:0 12px;white-space:nowrap;border-right:1px solid var(--border-subtle);font-size:11px;color:var(--text-muted)}.tab-switcher-help span:last-child{border-right:none}kbd{display:inline-flex;align-items:center;justify-content:center;min-width:20px;height:20px;padding:0 6px;background:var(--bg-glass);border:1px solid var(--border-subtle);border-radius:4px;font-family:-apple-system,BlinkMacSystemFont,SF Pro Text,Segoe UI,sans-serif;font-size:11px;font-weight:500;color:var(--text-secondary);box-shadow:none;transition:none;margin-right:3px}kbd:hover{background:var(--bg-glass-hover);border-color:var(--border-hover);color:var(--text-primary)}@keyframes backdropFadeIn{0%{opacity:0;-webkit-backdrop-filter:blur(0);backdrop-filter:blur(0)}to{opacity:1;-webkit-backdrop-filter:blur(20px) saturate(150%);backdrop-filter:blur(20px) saturate(150%)}}@keyframes containerSlideIn{0%{opacity:0;transform:translateY(-8px) scale(.98)}to{opacity:1;transform:translateY(0) scale(1)}}@keyframes cardFadeIn{0%{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}.tab-switcher-grid.recent-mode .tab-card{width:100%;height:auto;min-height:52px;flex-direction:row;align-items:center;padding:10px 14px;gap:12px;border:1px solid var(--border-subtle);border-radius:var(--radius-md);box-shadow:none}.tab-switcher-grid.recent-mode .tab-card:hover{transform:none;border-color:var(--border-hover);box-shadow:none}.tab-switcher-grid.recent-mode .tab-card.selected{border-color:var(--accent);background:var(--card-selected);transform:none!important;box-shadow:0 0 0 2px var(--accent-glow)!important}.tab-switcher-grid.recent-mode .tab-thumbnail{flex:0 0 40px;height:40px;width:40px;min-height:40px;border-radius:var(--radius-sm);background:var(--bg-glass)}.tab-switcher-grid.recent-mode .favicon-tile{border-radius:var(--radius-sm)}.tab-switcher-grid.recent-mode .favicon-large{width:26px;height:26px}.tab-switcher-grid.recent-mode .favicon-letter{width:40px;height:40px;font-size:17px;border-radius:var(--radius-sm)}.tab-switcher-grid.recent-mode .tab-info{flex:1;padding:0;min-width:0}.tab-switcher-grid.recent-mode .tab-header{margin-bottom:3px}.tab-switcher-grid.recent-mode .tab-title{font-size:14px}.tab-switcher-grid.recent-mode .tab-url{padding-left:0;font-size:12px}.tab-switcher-grid.recent-mode .tab-close-btn{display:none}.tab-switcher-grid.search-mode .tab-card{width:100%;height:auto;min-height:52px;flex-direction:row;align-items:center;padding:10px 14px;gap:12px;border:1px solid var(--border-subtle);border-radius:var(--radius-md);box-shadow:none}.tab-switcher-grid.search-mode .tab-card:hover{transform:none;border-color:var(--border-hover);box-shadow:none}.tab-switcher-grid.search-mode .tab-card.selected{border-color:var(--accent);background:var(--card-selected);transform:none!important;box-shadow:0 0 0 2px var(--accent-glow)!important}.tab-switcher-grid.search-mode .tab-thumbnail{flex:0 0 36px;height:36px;width:36px;min-height:36px;border-radius:var(--radius-sm);background:var(--bg-glass)}.tab-switcher-grid.search-mode .tab-info{flex:1;padding:0;min-width:0}.tab-switcher-grid.search-mode .tab-title{font-size:14px}.tab-switcher-grid.search-mode .tab-url{padding-left:0;font-size:12px;display:block}@media(max-width:768px){.tab-switcher-container{padding:0;max-width:98vw;max-height:90vh}.tab-switcher-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px;padding:10px}.tab-card{height:140px}.tab-switcher-help{gap:0;font-size:10px;padding:6px 10px}.tab-switcher-help span{padding:0 6px}kbd{min-width:16px;height:16px;padding:0 4px;font-size:9px}.recently-closed-btn{padding:0 12px;font-size:12px}}.history-view{display:grid;grid-template-columns:1fr 1fr;gap:24px;height:100%;overflow:hidden;padding:0 12px}.history-column{display:flex;flex-direction:column;gap:8px;overflow-y:auto;padding-right:4px;scrollbar-width:thin;scrollbar-color:rgba(255,255,255,.15) transparent}.history-column::-webkit-scrollbar{width:5px}.history-column::-webkit-scrollbar-track{background:transparent;margin:4px 0}.history-column::-webkit-scrollbar-thumb{background:#ffffff26;border-radius:100px;transition:background .2s ease}.history-column::-webkit-scrollbar-thumb:hover{background:#ffffff40}.history-column::-webkit-scrollbar-thumb:active{background:#ffffff59}@media(prefers-color-scheme:light){.history-column{scrollbar-color:rgba(0,0,0,.12) transparent}.history-column::-webkit-scrollbar-thumb{background:#0000001f}.history-column::-webkit-scrollbar-thumb:hover{background:#0003}.history-column::-webkit-scrollbar-thumb:active{background:#0000004d}}.history-column-header{font-size:14px;font-weight:600;color:var(--text-muted);margin-bottom:8px;padding-left:12px;text-transform:uppercase;letter-spacing:.05em;position:sticky;top:0;background:var(--bg-surface);z-index:10;padding-top:8px;padding-bottom:8px}.history-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:var(--radius-lg);background:var(--card-bg);border:1px solid transparent;cursor:pointer;transition:all var(--transition-fast)}.history-favicon{width:16px;height:16px;border-radius:4px;flex-shrink:0}.history-item:hover{background:var(--card-hover);border-color:var(--border-hover)}.history-item.selected{background:var(--card-selected);border-color:var(--accent)}.history-item-content{flex:1;min-width:0}.history-item-title{font-size:14px;font-weight:500;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px}.history-item-url{font-size:12px;color:var(--text-muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.history-items-container{display:flex;flex-direction:column;gap:8px}',K="tab-switcher-host",ue=he,ee=document.createElement("template");ee.innerHTML=`
  <div class="tab-card" role="option" tabindex="-1" style="transform: translate3d(0, 0, 0);">
    <div class="tab-thumbnail"></div>
    <div class="tab-info">
      <div class="tab-header">
        <img class="tab-favicon" loading="lazy" decoding="async" style="display: none;">
        <div class="tab-title"></div>
      </div>
      <div class="tab-url" style="display: none;"></div>
    </div>
    <div class="tab-media-controls"></div>
    <button class="tab-close-btn" data-action="close" title="Close tab">Ã—</button>
  </div>
`;const j="http://www.w3.org/2000/svg";function R(t){const r=document.createElementNS(j,"svg");r.setAttribute("viewBox","0 0 24 24");const i=document.createElementNS(j,"path");return i.setAttribute("d",t),r.appendChild(i),r}const be=R("M8 5v14l11-7z"),pe=R("M6 19h4V5H6v14zm8-14v14h4V5h-4z"),me=R("M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"),fe=R("M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z");function ge(t){return t.cloneNode(!0)}function Q(t,r,i,n){const a=document.createElement("button");return a.className=t,a.dataset.action=r,a.title=n,a.appendChild(ge(i)),a}function w(t){const r=performance.now(),i=e.domCache.grid;if(!i)return;if(i.innerHTML="",i.classList.remove("virtual-list"),i.style.minHeight="",t.length===0){const o=document.createElement("div");o.className="tab-switcher-empty",o.textContent="No tabs found",i.appendChild(o);return}const n=document.createDocumentFragment();t.forEach((o,s)=>{const c=te(o,s);o.isGroupHeader&&(c.dataset.isHeader="true"),c.dataset.tabIndex=String(s),n.appendChild(c)}),i.appendChild(n),z(!1);const a=performance.now()-r;console.log(`[PERF] Rendered ${t.length} tabs in ${a.toFixed(2)}ms`)}function T(t){const r=performance.now(),i=e.domCache.grid;if(!i)return;if(i.innerHTML="",i.classList.add("virtual-list"),t.length===0){const m=document.createElement("div");m.className="tab-switcher-empty",m.textContent="No tabs found",i.appendChild(m);return}const n=68,a=e.virtualScroll.visibleCount,o=e.virtualScroll.bufferCount,s=Math.max(0,e.selectedIndex-o),c=Math.min(t.length,e.selectedIndex+a+o);e.virtualScroll.startIndex=s,e.virtualScroll.endIndex=c;const d=t.length*n;i.style.minHeight=`${d}px`;const l=document.createDocumentFragment();for(let m=s;m<c;m++){const k=t[m],f=te(k,m);f.style.position="absolute",f.style.top=`${m*n}px`,f.style.left="0",f.style.right="0",l.appendChild(f)}i.appendChild(l),xe(),z(!1);const u=performance.now()-r;console.log(`[PERF] Virtual rendered ${c-s} of ${t.length} tabs in ${u.toFixed(2)}ms`)}function te(t,r){const n=ee.content.cloneNode(!0).firstElementChild;t&&typeof t.id=="number"&&(n.dataset.tabId=String(t.id)),t?.sessionId&&(n.dataset.sessionId=t.sessionId,n.dataset.recent="1"),t?.isWebSearch&&(n.dataset.webSearch="1",n.dataset.searchQuery=t.searchQuery),n.dataset.tabIndex=String(r);const a=t.title??"Untitled",o=t.url??"";n.setAttribute("aria-selected",r===e.selectedIndex?"true":"false"),n.setAttribute("aria-label",`${a} - ${o}`);const s=typeof t.screenshot=="string"&&t.screenshot.length>0?t.screenshot:null,c=!!s,d=n.classList;d.add(c?"has-screenshot":"has-favicon"),r===e.selectedIndex&&d.add("selected"),t.pinned&&d.add("pinned"),t.sessionId&&d.add("recent-item");let l=null,u=null;if(t.groupId&&t.groupId!==-1&&e.groups){const h=e.groups.find(p=>p.id===t.groupId);h&&(l=ke(h.color),u=h.title||"Group",n.dataset.groupId=String(h.id),n.style.borderLeft=`6px solid ${l}`,n.style.background=`linear-gradient(to right, ${l}15, rgba(255,255,255,0.02))`)}const m=n.querySelector(".tab-thumbnail"),k=n.querySelector(".tab-title"),f=n.querySelector(".tab-url"),v=n.querySelector(".tab-favicon"),g=n.querySelector(".tab-media-controls"),E=n.querySelector(".tab-close-btn");if(k.textContent=a,k.title=a,t.sessionId||!s){const h=ve(t);m.appendChild(h)}else if(s){const h=document.createElement("img");h.className="screenshot-img",h.alt=a,h.loading="lazy",h.decoding="async",Math.abs(r-e.selectedIndex)<10?h.src=s:h.dataset.src=s,m.appendChild(h)}if(c){let h=t.favIconUrl;if(!h&&t.url)try{const p=new URL(chrome.runtime.getURL("/_favicon/"));p.searchParams.set("pageUrl",t.url),p.searchParams.set("size","16"),h=p.toString()}catch{}h&&(v.src=h,v.style.display="",v.onerror=()=>{v.style.display="none"}),f.textContent=o,f.title=o,f.style.display=""}if(l&&u){const h=n.querySelector(".tab-header"),p=document.createElement("span");p.className="group-pill",p.textContent=u,p.style.cssText=`background-color:${l};opacity:0.4;color:white;font-size:10px;font-weight:700;padding:2px 6px;border-radius:40px;margin-left:8px;white-space:nowrap;`,h.appendChild(p)}if(!t.sessionId&&!t.isWebSearch){const h=t.hasMedia||!1,p=t.audible||!1,x=t.mutedInfo?.muted||!1,de=h||p||x;if(h&&d.add("has-media"),p&&d.add("is-audible"),x&&d.add("is-muted"),E.dataset.tabId=String(t.id),de){const N=Q("tab-play-btn visible","play-pause",p?pe:be,p?"Pause tab":"Play tab");N.dataset.tabId=String(t.id),p&&N.classList.add("playing"),g.appendChild(N);const P=Q("tab-mute-btn visible","mute",x?me:fe,x?"Unmute tab":"Mute tab");P.dataset.tabId=String(t.id),x&&P.classList.add("muted"),g.appendChild(P)}}else g.style.display="none",E.style.display="none";return n}const re=document.createElement("template");re.innerHTML='<div class="favicon-tile"><img class="favicon-large" loading="lazy" decoding="async"><div class="favicon-letter" style="display:none;"></div></div>';function ve(t){const i=re.content.cloneNode(!0).firstElementChild,n=i.querySelector(".favicon-large"),a=i.querySelector(".favicon-letter");let o=t.favIconUrl;if(!o&&t.url)try{const s=new URL(chrome.runtime.getURL("/_favicon/"));s.searchParams.set("pageUrl",t.url),s.searchParams.set("size","32"),o=s.toString()}catch{}return o?(n.src=o,n.onerror=()=>{n.style.display="none",a.textContent=(t.title||"T")[0].toUpperCase(),a.style.display=""}):(n.style.display="none",a.textContent=(t.title||"T")[0].toUpperCase(),a.style.display=""),i}function z(t){try{const r=e.domCache.grid;if(!r)return;r.querySelectorAll(".tab-card.selected").forEach(a=>{a.classList.remove("selected"),a.setAttribute("aria-selected","false")});const n=r.querySelector(`.tab-card[data-tab-index="${e.selectedIndex}"]`);if(!n)return;n.classList.add("selected"),n.setAttribute("aria-selected","true"),r.setAttribute("aria-activedescendant",n.id||`tab-card-${e.selectedIndex}`),n.id||(n.id=`tab-card-${e.selectedIndex}`),t&&requestAnimationFrame(()=>{n.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})})}catch(r){console.error("[TAB SWITCHER] Error enforcing selection:",r)}}function ae(){try{if(!e.domCache.grid)return;if(e.filteredTabs&&e.filteredTabs.length>50){const{startIndex:r,endIndex:i}=e.virtualScroll;(e.selectedIndex<r||e.selectedIndex>=i)&&T(e.filteredTabs)}z(!0)}catch(t){console.error("[TAB SWITCHER] Error in updateSelection:",t)}}function xe(){e.intersectionObserver&&e.intersectionObserver.disconnect();const t=new IntersectionObserver(n=>{n.forEach(a=>{if(!a.isIntersecting)return;const o=a.target;o instanceof HTMLImageElement&&o.dataset.src&&!o.src&&(o.src=o.dataset.src,t.unobserve(o))})},{rootMargin:"100px"});e.intersectionObserver=t;const r=e.domCache.grid;if(!r)return;r.querySelectorAll("img[data-src]").forEach(n=>t.observe(n))}function we(t){const r=e.domCache.grid;if(!r)return;r.innerHTML="",r.className="tab-switcher-grid search-mode";const i=document.createElement("div");i.className="history-view",e.history.active=!0,e.history.backEls=[],e.history.forwardEls=[];const n=document.createElement("div");n.className="history-column";const a=document.createElement("div");if(a.className="history-column-header",a.textContent="â† BACK",n.appendChild(a),t.back&&t.back.length>0){const c=document.createElement("div");c.className="history-items-container",t.back.forEach((d,l)=>{const u=Y(d,-(l+1));u.dataset.column="back",u.dataset.index=String(l),c.appendChild(u),e.history.backEls.push(u)}),n.appendChild(c)}else{const c=document.createElement("div");c.className="tab-switcher-empty",c.textContent="No back history",c.style.padding="20px",c.style.textAlign="center",c.style.color="var(--text-muted)",n.appendChild(c)}const o=document.createElement("div");o.className="history-column";const s=document.createElement("div");if(s.className="history-column-header",s.textContent="FORWARD â†’",o.appendChild(s),t.forward&&t.forward.length>0){const c=document.createElement("div");c.className="history-items-container",t.forward.forEach((d,l)=>{const u=Y(d,l+1);u.dataset.column="forward",u.dataset.index=String(l),c.appendChild(u),e.history.forwardEls.push(u)}),o.appendChild(c)}else{const c=document.createElement("div");c.className="tab-switcher-empty",c.textContent="No forward history",c.style.padding="20px",c.style.textAlign="center",c.style.color="var(--text-muted)",o.appendChild(c)}i.appendChild(n),i.appendChild(o),r.appendChild(i),e.history.backEls.length>0?(e.history.column="back",e.history.index=0):e.history.forwardEls.length>0&&(e.history.column="forward",e.history.index=0),A()}function Y(t,r){const i=typeof t=="string"?t:t.url,n=typeof t=="string"?t:t.title||t.url,a=document.createElement("div");a.className="history-item",a.tabIndex=0,a.dataset.delta=String(r),a.onclick=()=>{window.history.go(r),b()},a.onkeydown=l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),window.history.go(r),b())};const o=document.createElement("img");o.className="history-favicon";try{const l=new URL(chrome.runtime.getURL("/_favicon/"));l.searchParams.set("pageUrl",i),l.searchParams.set("size","16"),o.src=l.toString()}catch{}const s=document.createElement("div");s.className="history-item-content";const c=document.createElement("div");c.className="history-item-title",c.textContent=n,c.title=n;const d=document.createElement("div");d.className="history-item-url";try{const l=new URL(i);d.textContent=l.hostname+l.pathname}catch{d.textContent=i}return d.title=i,s.appendChild(c),s.appendChild(d),a.appendChild(o),a.appendChild(s),a}function A(){const t=e.history.backEls||[],r=e.history.forwardEls||[];for(const o of t)o.classList.remove("selected");for(const o of r)o.classList.remove("selected");const i=e.history.column==="forward"?r:t;if(!i.length)return;const n=Math.min(Math.max(0,e.history.index),i.length-1);e.history.index=n;const a=i[n];a&&(a.classList.add("selected"),a.scrollIntoView({block:"nearest"}))}function ye(){const t=e.history.backEls||[],r=e.history.forwardEls||[],n=(e.history.column==="forward"?r:t)[e.history.index];if(!n)return;const a=Number(n.dataset.delta);Number.isFinite(a)&&(window.history.go(a),b())}function ke(t){return{grey:"#bdc1c6",blue:"#8ab4f8",red:"#f28b82",yellow:"#fdd663",green:"#81c995",pink:"#ff8bcb",purple:"#c58af9",cyan:"#78d9ec",orange:"#fcad70"}[t]||t}function Ee(t){try{const r=t.target;if(r.dataset.action==="close"||r.classList.contains("tab-close-btn")){t.stopPropagation();const a=parseInt(r.dataset.tabId||r.parentElement.dataset.tabId||"0"),o=parseInt(r.dataset.tabIndex||r.parentElement.dataset.tabIndex||"0");a&&!Number.isNaN(a)&&G(a,o);return}if(r.dataset.action==="mute"||r.closest(".tab-mute-btn")){t.stopPropagation();const a=r.closest(".tab-mute-btn"),o=parseInt(a.dataset.tabId||"0");o&&!Number.isNaN(o)&&Se(o,a);return}if(r.dataset.action==="play-pause"||r.closest(".tab-play-btn")){t.stopPropagation();const a=r.closest(".tab-play-btn"),o=parseInt(a.dataset.tabId||"0");o&&!Number.isNaN(o)&&Le(o,a);return}const i=r.closest(".tab-card");if(!i)return;if(e.viewMode==="recent"||i.dataset.recent==="1"){const a=i.dataset.sessionId;a&&_(a);return}if(i.dataset.webSearch==="1"){const a=i.dataset.searchQuery;a&&(window.open(`https://www.google.com/search?q=${encodeURIComponent(a)}`,"_blank"),b());return}const n=parseInt(i.dataset.tabId||"0");n&&!Number.isNaN(n)?F(n):console.error("[TAB SWITCHER] Invalid tab ID in card:",i)}catch(r){console.error("[TAB SWITCHER] Error in handleGridClick:",r)}}function ne(){return((e.domCache?.searchBox&&typeof e.domCache.searchBox.value=="string"?e.domCache.searchBox.value:"")||"").trim().startsWith(";")}function D(t){if(!e.isOverlayVisible)return;if(t.key==="Escape"){t.preventDefault(),t.stopPropagation(),typeof t.stopImmediatePropagation=="function"&&t.stopImmediatePropagation(),b();return}const r=t.target===e.domCache.searchBox||t.composedPath&&e.domCache.searchBox&&t.composedPath().includes(e.domCache.searchBox),i=ne()&&e.history.active,a=i&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"].includes(t.key);if(r&&!a)return;const o=performance.now();if(o-e.lastKeyTime<e.keyThrottleMs){t.preventDefault();return}e.lastKeyTime=o;try{if(i)switch(t.key){case"Enter":t.preventDefault(),ye();return;case"ArrowDown":{t.preventDefault();const s=e.history.column==="forward"?e.history.forwardEls:e.history.backEls;s.length&&(e.history.index=Math.min(e.history.index+1,s.length-1),A());return}case"ArrowUp":{t.preventDefault(),(e.history.column==="forward"?e.history.forwardEls:e.history.backEls).length&&(e.history.index=Math.max(e.history.index-1,0),A());return}case"ArrowLeft":{t.preventDefault(),e.history.column==="forward"&&e.history.backEls.length&&(e.history.column="back",e.history.index=Math.min(e.history.index,e.history.backEls.length-1),A());return}case"ArrowRight":{t.preventDefault(),e.history.column==="back"&&e.history.forwardEls.length&&(e.history.column="forward",e.history.index=Math.min(e.history.index,e.history.forwardEls.length-1),A());return}}switch(t.key){case"Enter":if(t.preventDefault(),e.filteredTabs.length>0&&e.selectedIndex>=0&&e.selectedIndex<e.filteredTabs.length){const s=e.filteredTabs[e.selectedIndex];if(s)if(s.isWebSearch){const c=(s.searchQuery||"").trim();c&&(window.open(`https://www.google.com/search?q=${encodeURIComponent(c)}`,"_blank"),b())}else e.viewMode==="recent"&&s.sessionId?_(s.sessionId):s.id&&F(s.id)}break;case"Tab":if(t.preventDefault(),e.domCache?.searchBox){const s=e.domCache.searchBox.value.trim();t.shiftKey?I():e.viewMode==="recent"?y():s.length===0?(e.webSearch.active=!e.webSearch.active,e.domCache.searchBox.dispatchEvent(new Event("input",{bubbles:!0})),e.domCache.searchBox.focus()):s.startsWith(";")?y():(window.open(`https://www.google.com/search?q=${encodeURIComponent(s)}`,"_blank"),b())}else t.shiftKey?I():y();break;case"ArrowRight":t.preventDefault(),ie();break;case"ArrowLeft":t.preventDefault(),oe();break;case"ArrowDown":t.preventDefault(),y();break;case"ArrowUp":t.preventDefault(),I();break;case"Delete":if(e.viewMode!=="recent"&&e.filteredTabs.length>0&&e.selectedIndex>=0&&e.selectedIndex<e.filteredTabs.length){t.preventDefault();const s=e.filteredTabs[e.selectedIndex];s?.id&&G(s.id,e.selectedIndex)}break;case"g":case"G":if(t.altKey&&(t.preventDefault(),e.viewMode!=="recent"&&e.filteredTabs.length>0&&e.selectedIndex>=0&&e.selectedIndex<e.filteredTabs.length)){const s=e.filteredTabs[e.selectedIndex];s?.id&&Me(s.id)}break}}catch(s){console.error("[TAB SWITCHER] Error in handleKeyDown:",s)}}function W(){}function Te(t){try{if(ne()&&e.history.active&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter"].includes(t.key)){t.preventDefault();return}if(["Delete","Tab","ArrowDown","ArrowUp","ArrowRight","ArrowLeft","Enter"].includes(t.key)){const a=performance.now();if(a-e.lastKeyTime<e.keyThrottleMs){t.preventDefault();return}e.lastKeyTime=a}if(t.key==="."&&(t.target.value||"").length===0){t.preventDefault(),e.viewMode==="recent"?U():ce();return}if(t.key==="Backspace"){const a=t.target.value||"";if(a.length===0&&e.webSearch.active){t.preventDefault(),e.webSearch.active=!1,e.domCache?.searchBox&&e.domCache.searchBox.dispatchEvent(new Event("input",{bubbles:!0}));return}if(a.length===0&&e.viewMode==="recent"){t.preventDefault(),U();return}return}if(t.key==="Delete"){if(t.preventDefault(),e.viewMode!=="recent"&&e.filteredTabs.length>0&&e.selectedIndex>=0&&e.selectedIndex<e.filteredTabs.length){const a=e.filteredTabs[e.selectedIndex];a?.id&&G(a.id,e.selectedIndex)}return}if(t.key==="Tab"){t.preventDefault();const o=(t.target.value||"").trim();t.shiftKey?I():e.viewMode==="recent"?y():o.length===0?(e.webSearch.active=!e.webSearch.active,e.domCache?.searchBox&&e.domCache.searchBox.dispatchEvent(new Event("input",{bubbles:!0}))):o.startsWith(";")?y():(window.open(`https://www.google.com/search?q=${encodeURIComponent(o)}`,"_blank"),b());return}if(t.key==="ArrowDown"){t.preventDefault(),y();return}if(t.key==="ArrowUp"){t.preventDefault(),I();return}if(t.key==="ArrowRight"){t.preventDefault(),ie();return}if(t.key==="ArrowLeft"){t.preventDefault(),oe();return}if(t.key==="Enter"){if(t.preventDefault(),e.filteredTabs.length>0&&e.selectedIndex>=0&&e.selectedIndex<e.filteredTabs.length){const a=e.filteredTabs[e.selectedIndex];e.viewMode==="recent"&&a?.sessionId?_(a.sessionId):a?.isWebSearch?(window.open(`https://www.google.com/search?q=${encodeURIComponent(a.searchQuery)}`,"_blank"),b()):a?.id&&a.id>=0&&F(a.id)}return}}catch(r){console.error("[TAB SWITCHER] Error in handleSearchKeydown:",r)}}function y(){!e.filteredTabs||e.filteredTabs.length===0||(e.selectedIndex++,e.selectedIndex>=e.filteredTabs.length&&(e.selectedIndex=0),ae())}function I(){!e.filteredTabs||e.filteredTabs.length===0||(e.selectedIndex--,e.selectedIndex<0&&(e.selectedIndex=e.filteredTabs.length-1),ae())}function ie(){y()}function oe(){I()}function Ce(){if(e.pageLock)return;const t=document.body;if(!t)return;const r="inert"in t;e.pageLock={bodyPointerEvents:t.style.pointerEvents,bodyUserSelect:t.style.userSelect,bodyInert:r?!!t.inert:!1};try{r&&(t.inert=!0)}catch{}t.style.pointerEvents="none",t.style.userSelect="none"}function J(){if(!e.pageLock)return;const t=document.body;if(!t){e.pageLock=null;return}const r="inert"in t;try{r&&(t.inert=e.pageLock.bodyInert)}catch{}t.style.pointerEvents=e.pageLock.bodyPointerEvents,t.style.userSelect=e.pageLock.bodyUserSelect,e.pageLock=null}function Ie(){try{if(document.activeElement&&document.activeElement!==document.body&&document.activeElement!==e.host){const r=document.activeElement;r instanceof HTMLElement&&r.blur()}document.querySelectorAll("iframe").forEach(r=>{try{const i=r.contentDocument?.activeElement;i instanceof HTMLElement&&i.blur()}catch{}})}catch(t){console.debug("[TAB SWITCHER] Error blurring page elements:",t)}}function C(t){return t.target===e.host?!0:(t.composedPath?t.composedPath():[]).some(i=>i===e.host||i===e.shadowRoot||i===e.overlay)}function O(t){e.isOverlayVisible&&(C(t)||(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),t.target instanceof HTMLElement&&t.target.blur(),e.domCache?.searchBox&&e.domCache.searchBox.focus()))}function S(t){if(e.isOverlayVisible&&!C(t)){if(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),e.domCache?.searchBox&&(e.domCache.searchBox.focus(),t.key&&t.key.length===1&&!t.ctrlKey&&!t.altKey&&!t.metaKey)){const r=e.domCache.searchBox,i=r.selectionStart||0,n=r.selectionEnd||0,a=r.value;r.value=a.slice(0,i)+t.key+a.slice(n),r.setSelectionRange(i+1,i+1),r.dispatchEvent(new Event("input",{bubbles:!0}))}return}}function L(t){if(e.isOverlayVisible&&!C(t))if(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),t instanceof InputEvent&&t.type==="beforeinput"&&typeof t.data=="string"&&e.domCache?.searchBox){const r=e.domCache.searchBox;r.focus();const i=r.selectionStart||0,n=r.selectionEnd||0,a=r.value;r.value=a.slice(0,i)+t.data+a.slice(n),r.setSelectionRange(i+t.data.length,i+t.data.length),r.dispatchEvent(new Event("input",{bubbles:!0}))}else e.domCache?.searchBox&&e.domCache.searchBox.focus()}function M(t){e.isOverlayVisible&&(C(t)||(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()))}function se(t){e.isOverlayVisible&&(C(t)||(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),t.target instanceof HTMLElement&&t.target.blur(),e.domCache?.searchBox&&e.domCache.searchBox.focus()))}function H(t){e.isOverlayVisible&&(C(t)||(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault()))}function b(){try{if(!e.isOverlayVisible||e.isClosing)return;e.isClosing=!0,J(),requestAnimationFrame(()=>{e.overlay&&(e.overlay.style.opacity="0"),e.closeTimeout&&clearTimeout(e.closeTimeout),e.closeTimeout=setTimeout(()=>{e.closeTimeout=null,e.isClosing=!1,e.overlay&&(e.overlay.style.display="none"),e.isOverlayVisible=!1,e.focusInterval&&(clearInterval(e.focusInterval),e.focusInterval=null),e.lastFullscreenElement=null,document.removeEventListener("keydown",D,!0),document.removeEventListener("keyup",W,!0),document.removeEventListener("focus",O,!0),document.removeEventListener("focusin",se,!0),document.removeEventListener("keydown",S,!0),document.removeEventListener("keypress",S,!0),document.removeEventListener("keyup",S,!0),document.removeEventListener("input",L,!0),document.removeEventListener("beforeinput",L,!0),document.removeEventListener("textInput",L,!0),document.removeEventListener("click",H,!0),document.removeEventListener("mousedown",H,!0),document.removeEventListener("compositionstart",M,!0),document.removeEventListener("compositionupdate",M,!0),document.removeEventListener("compositionend",M,!0),e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null),e.resizeObserver&&(e.resizeObserver.disconnect(),e.resizeObserver=null)},200)})}catch(t){console.error("[TAB SWITCHER] Error in closeOverlay:",t),e.isOverlayVisible=!1,e.isClosing=!1,J(),e.focusInterval&&(clearInterval(e.focusInterval),e.focusInterval=null);try{document.removeEventListener("keydown",D,!0),document.removeEventListener("keyup",W,!0),document.removeEventListener("focus",O,!0)}catch{}}}function F(t){try{if(!t||typeof t!="number"){console.error("[TAB SWITCHER] Invalid tab ID:",t);return}try{chrome.runtime.sendMessage({action:"switchToTab",tabId:t},()=>{chrome.runtime.lastError&&console.debug("[TAB SWITCHER] SW not ready:",chrome.runtime.lastError.message)})}catch(r){console.debug("[TAB SWITCHER] sendMessage warn:",r?.message||r)}b()}catch(r){console.error("[TAB SWITCHER] Exception in switchToTab:",r),b()}}function _(t){try{if(!t)return;try{chrome.runtime.sendMessage({action:"restoreSession",sessionId:t},()=>{chrome.runtime.lastError&&console.debug("[TAB SWITCHER] SW not ready (restoreSession):",chrome.runtime.lastError.message)})}catch(r){console.debug("[TAB SWITCHER] sendMessage warn:",r?.message||r)}b()}catch(r){console.error("[TAB SWITCHER] Exception in restoreSession:",r),b()}}function G(t,r){try{if(!t||typeof t!="number"){console.error("[TAB SWITCHER] Invalid tab ID for closing:",t);return}if(!e.currentTabs.some(n=>n&&n.id===t)){console.warn("[TAB SWITCHER] Tab no longer exists:",t),e.filteredTabs=e.filteredTabs.filter(n=>n&&n.id!==t),e.currentTabs=e.currentTabs.filter(n=>n&&n.id!==t),e.selectedIndex>=e.filteredTabs.length&&(e.selectedIndex=Math.max(0,e.filteredTabs.length-1)),e.filteredTabs.length>0?e.filteredTabs.length>50?T(e.filteredTabs):w(e.filteredTabs):b();return}chrome.runtime.sendMessage({action:"closeTab",tabId:t},n=>{if(chrome.runtime.lastError){console.error("[TAB SWITCHER] Error closing tab:",chrome.runtime.lastError.message);return}n?.success&&(e.currentTabs=e.currentTabs.filter(a=>a&&a.id!==t),e.filteredTabs=e.filteredTabs.filter(a=>a&&a.id!==t),e.filteredTabs.length>0?(e.selectedIndex>=e.filteredTabs.length&&(e.selectedIndex=Math.max(0,e.filteredTabs.length-1)),e.filteredTabs.length>50?T(e.filteredTabs):w(e.filteredTabs),e.domCache.searchBox&&e.domCache.searchBox.focus()):b())})}catch(i){console.error("[TAB SWITCHER] Exception in closeTab:",i)}}function Se(t,r){try{if(!t)return;chrome.runtime.sendMessage({action:"toggleMute",tabId:t},i=>{if(chrome.runtime.lastError){console.error("[TAB SWITCHER] Error toggling mute:",chrome.runtime.lastError);return}if(i&&i.success){const n=i.muted;n?(r.classList.add("muted"),r.title="Unmute tab",r.innerHTML='<svg viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73 4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>'):(r.classList.remove("muted"),r.title="Mute tab",r.innerHTML='<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>');const a=e.currentTabs.find(o=>o.id===t);a&&(a.mutedInfo||(a.mutedInfo={muted:!1}),a.mutedInfo.muted=n)}})}catch(i){console.error("[TAB SWITCHER] Exception in toggleMute:",i)}}function Le(t,r){try{if(!t)return;chrome.runtime.sendMessage({action:"togglePlayPause",tabId:t},i=>{if(chrome.runtime.lastError){console.error("[TAB SWITCHER] Error toggling play/pause:",chrome.runtime.lastError);return}if(i&&i.success){const n=i.playing;n?(r.classList.add("playing"),r.title="Pause tab",r.innerHTML='<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>'):(r.classList.remove("playing"),r.title="Play tab",r.innerHTML='<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>');const a=e.currentTabs.find(o=>o.id===t);a&&(a.isPlaying=n,a.audible=n)}})}catch(i){console.error("[TAB SWITCHER] Exception in togglePlayPause:",i)}}function q(t){e.viewMode=t,e.domCache?.searchBox&&(e.domCache.searchBox.placeholder=t==="recent"?"Search recently closed tabs...":"Search tabs by title or URL..."),e.domCache?.sectionTitle&&(e.domCache.sectionTitle.textContent=t==="recent"?"Recently Closed":"Opened Tabs"),e.domCache?.tabHint&&e.domCache.tabHint.classList.toggle("hidden",t==="recent"),e.domCache?.helpText&&(t==="recent"?e.domCache.helpText.innerHTML=`
        <span><kbd>Alt+Q</kbd> <kbd>â†‘â†“</kbd> Navigate</span>
        <span><kbd>Enter</kbd> Restore</span>
        <span><kbd>Backspace</kbd> Active Tabs</span>
        <span><kbd>Esc</kbd> Exit</span>
      `:e.domCache.helpText.innerHTML=`
        <span><kbd>Alt+Q</kbd> <kbd>â†‘â†“</kbd> Navigate</span>
        <span><kbd>Enter</kbd> Switch Tab</span>
        <span><kbd>Delete</kbd> Close</span>
        <span><kbd>.</kbd> Recent Tabs</span>
        <span><kbd>;</kbd> Tab History</span>
        <span><kbd>Esc</kbd> Exit</span>
      `)}function Me(t){try{if(!t||typeof t!="number")return;chrome.runtime.sendMessage({action:"createGroup",tabId:t},r=>{if(chrome.runtime.lastError){console.error("[TAB SWITCHER] Error creating group:",chrome.runtime.lastError.message);return}r?.success&&b()})}catch(r){console.error("[TAB SWITCHER] Exception in createGroup:",r)}}function U(){if(e.viewMode==="active")return;q("active"),e.currentTabs=e.activeTabs||[];const t=e.currentTabs;e.filteredTabs=t,e.selectedIndex=0,e.domCache.grid&&(e.domCache.grid.classList.remove("recent-mode"),e.domCache.grid.classList.remove("search-mode")),e.filteredTabs.length>50?T(e.filteredTabs):w(e.filteredTabs),e.domCache.searchBox&&(e.domCache.searchBox.value="",e.domCache.searchBox.focus())}async function ce(){if(e.viewMode==="recent")return;q("recent");let t=[];try{t=await new Promise(r=>{try{chrome.runtime.sendMessage({action:"getRecentlyClosed",maxResults:10},i=>{if(chrome.runtime.lastError){console.debug("[TAB SWITCHER] Runtime error:",chrome.runtime.lastError.message),r([]);return}i?.success?r(i.items||[]):r([])})}catch{r([])}})}catch(r){console.debug("[TAB SWITCHER] Failed to load recently closed:",r)}e.recentItems=t.map((r,i)=>({id:void 0,title:r.title,url:r.url,favIconUrl:r.favIconUrl,screenshot:null,sessionId:r.sessionId,index:i})),e.currentTabs=e.recentItems,e.filteredTabs=e.recentItems,e.selectedIndex=0,e.domCache.grid&&e.domCache.grid.classList.add("recent-mode"),w(e.filteredTabs),e.domCache.searchBox&&e.domCache.searchBox.focus()}function Be(){try{if(!window.navigation||typeof window.navigation.entries!="function")return console.log("[TAB SWITCHER] Navigation API not available"),{back:[],forward:[]};const t=window.navigation.entries(),r=window.navigation.currentEntry;if(!t||t.length===0||!r)return console.log("[TAB SWITCHER] No navigation entries available"),{back:[],forward:[]};const i=r.index;console.log("[TAB SWITCHER] Navigation entries:",t.length,"Current index:",i);const n=[];for(let o=i-1;o>=0;o--){const s=t[o];s&&s.url&&n.push({url:s.url,title:X(s.url)})}const a=[];for(let o=i+1;o<t.length;o++){const s=t[o];s&&s.url&&a.push({url:s.url,title:X(s.url)})}return console.log("[TAB SWITCHER] Back entries:",n.length,"Forward entries:",a.length),{back:n,forward:a}}catch(t){return console.error("[TAB SWITCHER] Error getting navigation history:",t),{back:[],forward:[]}}}function X(t){try{const r=new URL(t);let i=r.hostname;if(i.startsWith("www.")&&(i=i.substring(4)),r.pathname&&r.pathname!=="/"){const n=r.pathname.split("/").filter(a=>a).pop();n&&n.length<50&&(i+=" - "+decodeURIComponent(n).replace(/[-_]/g," "))}return i}catch{return t}}const Ae=typeof requestIdleCallback<"u"?requestIdleCallback:t=>setTimeout(t,1),He=typeof cancelIdleCallback<"u"?cancelIdleCallback:clearTimeout;function Re(){let t=null,r=null,i=0;const n=100,a=250,o=50;return s=>{const c=performance.now(),d=c-i,l=e.currentTabs.length>=o;t&&(clearTimeout(t),t=null),r&&(He(r),r=null),!l&&d>=n?(i=c,V(s)):t=setTimeout(()=>{l?r=Ae(()=>{i=performance.now(),V(s)}):(i=performance.now(),V(s))},l?a:n)}}function V(t){try{const r=t.target,i=r instanceof HTMLInputElement?r.value:e.domCache?.searchBox?.value??"",n=String(i).trim();if(e.domCache?.tabHint){const c=n.length>0||e.viewMode==="recent"||e.webSearch.active;e.domCache.tabHint.classList.toggle("hidden",c)}if(n.startsWith(";")){e.webSearch.active=!1,e.history.active=!0,e.domCache.grid&&(e.domCache.grid.classList.add("search-mode"),e.domCache.grid.classList.remove("recent-mode")),e.domCache.sectionTitle&&(e.domCache.sectionTitle.textContent="Tab History"),e.domCache.helpText&&(e.domCache.helpText.innerHTML=`
            <span><kbd>;</kbd> History Mode</span>
            <span><kbd>â†â†’</kbd> Switch Column</span>
            <span><kbd>â†‘â†“</kbd> Navigate</span>
            <span><kbd>Enter</kbd> Go</span>
            <span><kbd>Backspace</kbd> Exit</span>
            <span><kbd>Esc</kbd> Close</span>
          `);const c=Be();console.log("[TAB SWITCHER] Navigation API history:",c),we(c);return}if(e.history.active=!1,e.history.backEls=[],e.history.forwardEls=[],e.viewMode!=="recent"&&e.webSearch.active){const c=n,d={title:c?`Search Web for "${c}"`:"Type to search web...",url:c?`https://www.google.com/search?q=${encodeURIComponent(c)}`:"",favIconUrl:"https://www.google.com/favicon.ico",isWebSearch:!0,searchQuery:c};e.filteredTabs=[d],e.selectedIndex=0,e.domCache.grid&&(e.domCache.grid.classList.add("search-mode"),e.domCache.grid.classList.remove("recent-mode")),e.domCache.sectionTitle&&(e.domCache.sectionTitle.textContent="Web Search"),w(e.filteredTabs);return}e.domCache.grid&&e.domCache.grid.classList.remove("search-mode"),e.domCache.sectionTitle&&(e.domCache.sectionTitle.textContent=e.viewMode==="recent"?"Recently Closed":"Opened Tabs");const a=t instanceof InputEvent&&t.inputType==="deleteContentBackward";if(n==="."&&!a){const c=e.domCache?.searchBox;c&&(c.value=""),e.viewMode==="recent"?U():ce();return}if(!n){e.filteredTabs=e.currentTabs,e.selectedIndex=0,e.currentTabs.length>50?T(e.currentTabs):w(e.currentTabs);return}const s=e.currentTabs.map(c=>{const d=Z(c.title,n),l=Z(c.url,n),u=d.score>l.score?d:l;return{tab:c,match:u.match,score:u.score}}).filter(c=>c.match).sort((c,d)=>d.score-c.score).map(c=>c.tab);e.filteredTabs=s,e.selectedIndex=0,s.length>50?T(s):w(s)}catch(r){console.error("[TAB SWITCHER] Error in handleSearch:",r),e.filteredTabs=e.currentTabs,e.selectedIndex=0,w(e.currentTabs)}}function Z(t,r){if(!t)return{match:!1,score:0};const i=String(t).toLowerCase(),n=String(r??"").toLowerCase();if(n.length===0)return{match:!0,score:1};if(i===n)return{match:!0,score:100};if(i.startsWith(n))return{match:!0,score:80+n.length/i.length*10};if(i.includes(n))return{match:!0,score:50+n.length/i.length*10};let a=0,o=0,s=0,c=0,d=-1;for(;a<i.length&&o<n.length;){if(i[a]===n[o]){d===-1&&(d=a);let l=1;c>0&&(l+=2+c),(a===0||i[a-1]===" "||i[a-1]==="."||i[a-1]==="/"||i[a-1]==="-")&&(l+=3),s+=l,c++,o++}else c=0;a++}return o<n.length?{match:!1,score:0}:(s-=(i.length-n.length)*.1,d>0&&(s-=d*.5),{match:!0,score:Math.max(1,s)})}let $="grid";try{chrome.storage.local.get(["tabSwitcherViewMode"],t=>{!chrome.runtime.lastError&&t.tabSwitcherViewMode&&($=t.tabSwitcherViewMode)})}catch{}function ze(){return $}function Ne(t){$=t;try{chrome.storage.local.set({tabSwitcherViewMode:t})}catch{}}function Pe(t){const r="__tabSwitcherEventGuardsInstalled";if(t[r])return;t[r]=!0;const i=a=>{e.isOverlayVisible&&C(a)&&(a.stopPropagation(),typeof a.stopImmediatePropagation=="function"&&a.stopImmediatePropagation())},n=["keydown","keyup","keypress","beforeinput","input","textInput","compositionstart","compositionupdate","compositionend","click","mousedown","mouseup","pointerdown","pointerup","contextmenu"];for(const a of n)t.addEventListener(a,i)}function Ve(){const t=document,r=document.fullscreenElement||t.webkitFullscreenElement;return r?r.tagName==="VIDEO"?r.parentElement||null:r:null}function le(){if(!e.host)return;const r=Ve()||document.documentElement||document.body;if(r)try{e.host.parentNode,r.appendChild(e.host)}catch{}}function De(){try{if(!e.host||!e.host.isConnected){e.shadowRoot=null,e.styleElement=null;const t=document.getElementById(K);if(t)e.host=t;else{const r=document.createElement("tab-switcher-mount");r.id=K,r.style.cssText=`
        all: initial !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 0 !important;
        height: 0 !important;
        min-width: 0 !important;
        min-height: 0 !important;
        max-width: 0 !important;
        max-height: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        border: none !important;
        overflow: visible !important;
        z-index: 2147483647 !important;
        pointer-events: auto !important;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
        contain: layout style !important;
        isolation: isolate !important;
      `,(document.documentElement||document.body).appendChild(r),e.host=r}}if(le(),e.shadowRoot||(e.host.shadowRoot?e.shadowRoot=e.host.shadowRoot:e.shadowRoot=e.host.attachShadow({mode:"open"})),!e.styleElement||!e.shadowRoot.contains(e.styleElement)){const t=document.createElement("style");t.textContent=ue,e.shadowRoot.appendChild(t),e.styleElement=t}return Pe(e.shadowRoot),e.shadowRoot}catch(t){return console.error("[TAB SWITCHER] Failed to initialize shadow root:",t),null}}function We(){if(e.overlay)return;const t=De();if(!t)return;const r=document.createElement("div");r.id="visual-tab-switcher-overlay",r.className="tab-switcher-overlay",r.style.willChange="opacity";const i=document.createElement("div");i.className="tab-switcher-backdrop",r.appendChild(i);const n=document.createElement("div");n.className="tab-switcher-container",n.style.transform="translate3d(0, 0, 0)";const a=document.createElement("div");a.className="tab-switcher-search-row";const o=document.createElement("div");o.className="tab-switcher-search-wrap";const s=document.createElement("input");s.type="text",s.className="tab-switcher-search",s.placeholder="Search tabs by title or URL...",s.autocomplete="off";const c=document.createElement("div");c.className="search-icon",c.innerHTML=`<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="3" y="3" width="7" height="7" rx="1"></rect>
    <rect x="14" y="3" width="7" height="7" rx="1"></rect>
    <rect x="3" y="14" width="7" height="7" rx="1"></rect>
    <rect x="14" y="14" width="7" height="7" rx="1"></rect>
  </svg>`;const d=document.createElement("div");d.className="search-tab-hint",d.innerHTML="<kbd>Tab</kbd> Search Google",o.appendChild(c),o.appendChild(s),o.appendChild(d),a.appendChild(o),n.appendChild(a);const l=document.createElement("div");l.className="tab-switcher-section-header";const u=document.createElement("span");u.className="tab-switcher-section-title",u.textContent="Opened Tabs";const m=document.createElement("div");m.className="tab-switcher-view-toggle";const k=ze(),f=document.createElement("button");f.type="button",f.className=`view-toggle-btn ${k==="grid"?"active":""}`,f.dataset.view="grid",f.title="Grid View",f.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <rect x="3" y="3" width="7" height="7" rx="1"></rect>
    <rect x="14" y="3" width="7" height="7" rx="1"></rect>
    <rect x="3" y="14" width="7" height="7" rx="1"></rect>
    <rect x="14" y="14" width="7" height="7" rx="1"></rect>
  </svg>`;const v=document.createElement("button");v.type="button",v.className=`view-toggle-btn ${k==="list"?"active":""}`,v.dataset.view="list",v.title="List View",v.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <line x1="3" y1="6" x2="21" y2="6"></line>
    <line x1="3" y1="12" x2="21" y2="12"></line>
    <line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>`,m.appendChild(f),m.appendChild(v),l.appendChild(u),l.appendChild(m),n.appendChild(l);const g=document.createElement("div");g.className=`tab-switcher-grid ${k==="list"?"list-view":""}`,g.id="tab-switcher-grid",g.setAttribute("role","listbox"),g.setAttribute("aria-label","Open tabs"),g.style.transform="translate3d(0, 0, 0)",n.appendChild(g);const E=document.createElement("div");E.className="tab-switcher-help",E.innerHTML=`
      <span><kbd>Alt+Q</kbd> <kbd>â†‘â†“</kbd> Navigate</span>
     <span><kbd>â†µ</kbd>Switch</span>
     <span><kbd>Del</kbd>Close</span>
     <span><kbd>.</kbd>Recent</span>
     <span><kbd>;</kbd>History</span>
     <span><kbd>Esc</kbd>Exit</span>
   `,n.appendChild(E),r.appendChild(n),s.addEventListener("input",Re()),s.addEventListener("keydown",Te),i.addEventListener("click",b),g.addEventListener("click",Ee),m.addEventListener("click",h=>{const p=h.target.closest(".view-toggle-btn");if(!p)return;const x=p.dataset.view;x&&(f.classList.toggle("active",x==="grid"),v.classList.toggle("active",x==="list"),g.classList.toggle("list-view",x==="list"),Ne(x))}),e.overlay=r,e.domCache={grid:g,searchBox:s,container:n,searchWrap:o,helpText:E,sectionTitle:u,tabHint:d},t.appendChild(r),console.log("[PERF] Overlay created with GPU acceleration and event delegation")}function Oe(t,r,i=[]){performance.now(),console.log(`[TAB SWITCHER] Opening with ${t.length} tabs and ${i.length} groups`);const n=document;if(e.lastFullscreenElement=document.fullscreenElement||n.webkitFullscreenElement||null,e.isOverlayVisible&&!e.isClosing)return;if(e.closeTimeout&&(clearTimeout(e.closeTimeout),e.closeTimeout=null),e.isClosing=!1,e.isOverlayVisible=!0,e.webSearch.active=!1,e.history.active=!1,We(),!e.overlay){e.isOverlayVisible=!1;return}const a=e.overlay;le(),a.style.display="flex",a.style.opacity="0",e.activeTabs=t,e.currentTabs=t,e.groups=i,e.filteredTabs=t,q("active"),e.domCache?.grid&&(e.domCache.grid.classList.remove("search-mode"),e.domCache.grid.classList.remove("recent-mode"));const o=t.findIndex(s=>s.id===r);t.length>1&&o===0?e.selectedIndex=1:(o>0,e.selectedIndex=0),e.filteredTabs.length>50?(console.log("[PERF] Using virtual scrolling for",e.filteredTabs.length,"tabs"),T(e.filteredTabs)):w(e.filteredTabs),a.style.display="flex",a.style.opacity="0",e.isOverlayVisible=!0,Ce(),Ie(),e.domCache.searchBox&&(e.domCache.searchBox.value="",e.domCache.searchBox.focus()),e.domCache.grid&&(e.domCache.grid.scrollTop=0),requestAnimationFrame(()=>{requestAnimationFrame(()=>{e.overlay&&(e.overlay.style.opacity="1")})}),document.addEventListener("keydown",D,!0),document.addEventListener("keyup",W,!0),document.addEventListener("focus",O,!0),document.addEventListener("focusin",se,!0),document.addEventListener("keydown",S,!0),document.addEventListener("keypress",S,!0),document.addEventListener("keyup",S,!0),document.addEventListener("input",L,!0),document.addEventListener("beforeinput",L,!0),document.addEventListener("textInput",L,!0),document.addEventListener("click",H,!0),document.addEventListener("mousedown",H,!0),document.addEventListener("compositionstart",M,!0),document.addEventListener("compositionupdate",M,!0),document.addEventListener("compositionend",M,!0),e.focusInterval&&clearInterval(e.focusInterval),e.focusInterval=setInterval(()=>{e.isOverlayVisible&&e.domCache.searchBox&&document.activeElement!==e.domCache.searchBox&&e.domCache.searchBox.focus()},100)}console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");console.log("Visual Tab Switcher - Content Script Loaded");console.log("Features: Virtual Scrolling, Event Delegation, GPU Acceleration");console.log("Target: <16ms interactions, 60fps, lazy loading");console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");function B(){try{const t=document.querySelectorAll("video, audio"),r=t.length>0;let i=!1;if(r){for(const n of t)if(!n.paused&&!n.ended&&n.readyState>2){i=!0;break}}r&&chrome.runtime.sendMessage({action:"reportMediaPresence",hasMedia:!0,isPlaying:i},()=>{chrome.runtime.lastError})}catch{}}function Ue(){try{document.addEventListener("play",()=>B(),!0),document.addEventListener("pause",()=>B(),!0),document.addEventListener("ended",()=>B(),!0)}catch{}}Ue();document.readyState==="complete"?B():window.addEventListener("load",B);const Fe=new MutationObserver(t=>{for(const r of t)if(r.addedNodes.length){B();break}});try{Fe.observe(document.body,{childList:!0,subtree:!0})}catch{}document.addEventListener("visibilitychange",()=>{document.hidden&&e.isOverlayVisible&&b()});window.addEventListener("beforeunload",()=>{e.isOverlayVisible&&b()});window.addEventListener("popstate",()=>{e.isOverlayVisible&&b()});chrome.runtime.onMessage.addListener((t,r,i)=>{if(t.action==="showTabSwitcher"){if(e.isOverlayVisible)return y(),z(!0),i({success:!0,advanced:!0}),!0;Oe(t.tabs,t.activeTabId,t.groups),i({success:!0})}return!0});export{Fe as mediaObserver};
