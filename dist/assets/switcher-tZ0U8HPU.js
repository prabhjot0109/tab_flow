import"./modulepreload-polyfill-B5Qt9EMX.js";let o=[],$=[],z=[],c=0,I="grid",l="active",d="",a=[],u=!1,i,r,H,q,E,A,M,D;async function _(){console.log("[SWITCHER POPUP] Initializing..."),i=document.getElementById("tab-switcher-grid"),r=document.querySelector(".tab-switcher-search"),H=document.querySelector('[data-view="grid"]'),q=document.querySelector('[data-view="list"]'),E=document.querySelector(".tab-switcher-section-title"),A=document.querySelector(".search-tab-hint"),M=document.querySelector(".tab-switcher-help"),D=document.querySelector(".tab-switcher-container"),document.querySelector(".tab-switcher-backdrop")?.addEventListener("click",()=>window.close());try{(await chrome.storage.local.get(["tabSwitcherViewMode"])).tabSwitcherViewMode==="list"&&(I="list",H.classList.remove("active"),q.classList.add("active"))}catch{}try{const t=await chrome.storage.session.get(["switcherTabData"]);if(t.switcherTabData){const n=t.switcherTabData;o=n.tabs,$=[...o],z=n.groups,a=[...o];const f=o.findIndex(m=>m.active);c=f>=0?Math.min(f+1,o.length-1):0,x(),v(),T(),chrome.storage.session.remove(["switcherTabData"])}else await O()}catch(t){console.error("[SWITCHER POPUP] Failed to load tab data:",t),await O()}j(),setTimeout(()=>r.focus(),50)}async function O(){try{const e=await chrome.runtime.sendMessage({action:"getTabsForSwitcher"});if(e&&e.tabs){o=e.tabs,$=[...o],z=e.groups||[],a=[...o];const t=o.findIndex(n=>n.active);c=t>=0?Math.min(t+1,o.length-1):0,x(),v(),T()}}catch(e){console.error("[SWITCHER POPUP] Failed to request tabs:",e)}}function j(){r.addEventListener("input",W),r.addEventListener("keydown",J),H.addEventListener("click",()=>V("grid")),q.addEventListener("click",()=>V("list")),document.addEventListener("keydown",X),i.addEventListener("click",Y),document.addEventListener("keydown",e=>{e.key==="Escape"&&window.close()}),chrome?.runtime?.onMessage&&chrome.runtime.onMessage.addListener((e,t,n)=>e?.action==="switcherPopupCycleNext"?(L(),v(),n?.({success:!0}),!0):!1)}function W(e){const t=r.value;d=t.toLowerCase().trim();const n=d.length>0||l==="recent"||u;A.classList.toggle("hidden",n);const f=e instanceof InputEvent&&e.inputType==="deleteContentBackward";if(t==="."&&!f){r.value="",d="",l==="recent"?K():ae();return}if(l!=="recent"&&u){a=[{id:-1,title:d?`Search Web for "${d}"`:"Type to search web...",url:d?`https://www.google.com/search?q=${encodeURIComponent(d)}`:"",favIconUrl:"https://www.google.com/favicon.ico",screenshot:null,pinned:!1,index:0,active:!1,isWebSearch:!0,searchQuery:d}],c=0,E.textContent="Web Search",i.classList.add("search-mode"),i.classList.remove("recent-mode"),D.classList.add("shrink-mode"),x(),v();return}i.classList.remove("search-mode"),D.classList.remove("shrink-mode"),E.textContent=l==="recent"?"Recently Closed":"Opened Tabs",d?(a=o.filter(m=>m.title.toLowerCase().includes(d)||m.url&&m.url.toLowerCase().includes(d)),E.textContent=`Results (${a.length})`,i.classList.add("search-mode")):(a=[...o],E.textContent=l==="recent"?"Recently Closed":"Opened Tabs",i.classList.remove("search-mode")),c=0,x(),v()}function J(e){if((e.key==="q"||e.key==="Q")&&e.altKey){e.preventDefault(),e.stopPropagation(),L();return}if(e.key==="Tab"&&!e.shiftKey){e.preventDefault(),e.stopPropagation();const t=r.value.trim();if(l==="recent")L();else if(t.length===0)u=!u,W(),T(),r.focus();else if(u&&t){const n=`https://www.google.com/search?q=${encodeURIComponent(t)}`;chrome.tabs.create({url:n}),window.close()}else{const n=`https://www.google.com/search?q=${encodeURIComponent(t)}`;chrome.tabs.create({url:n}),window.close()}}}function X(e){if((e.key==="q"||e.key==="Q")&&e.altKey){e.preventDefault(),e.stopPropagation(),L();return}if(e.key==="Tab"&&!e.shiftKey){e.preventDefault(),e.stopPropagation();const t=r.value.trim();if(l==="recent")L();else if(t.length===0)u=!u,W(),T(),r.focus();else{const n=`https://www.google.com/search?q=${encodeURIComponent(t)}`;chrome.tabs.create({url:n}),window.close()}return}if(e.key==="Tab"&&e.shiftKey){e.preventDefault(),e.stopPropagation(),B();return}if(e.key==="Backspace"&&r.value===""){if(u){u=!1,W(),T();return}if(l==="recent"){K();return}}if(!(document.activeElement===r&&!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Enter","Escape","Delete"].includes(e.key)))switch(e.key){case"ArrowUp":e.preventDefault(),B();break;case"ArrowDown":e.preventDefault(),L();break;case"ArrowLeft":e.preventDefault(),I==="grid"&&!d&&!u&&l!=="recent"?ee():B();break;case"ArrowRight":e.preventDefault(),I==="grid"&&!d&&!u&&l!=="recent"?te():L();break;case"Enter":e.preventDefault(),se();break;case"Delete":l!=="recent"&&(document.activeElement!==r||r.value==="")&&(e.preventDefault(),ce());break}}function Y(e){const t=e.target,n=t.closest(".tab-card");if(!n)return;if(n.classList.contains("web-search-card")){const k=r.value.trim();if(k){const S=`https://www.google.com/search?q=${encodeURIComponent(k)}`;chrome.tabs.create({url:S}),window.close()}return}const f=n.dataset.sessionId;if(f){e.stopPropagation(),Q(f);return}const m=parseInt(n.dataset.tabId||"0",10);if(m){if(t.closest(".tab-close-btn")){e.stopPropagation(),Z(m);return}G(m)}}function L(){if(a.length!==0){if(I==="grid"&&!d){ne();const e=c+1;c=e>=a.length?0:e}else c=(c+1)%a.length;v()}}function B(){if(a.length!==0){if(I==="grid"&&!d){const e=c-1;c=e<0?a.length-1:e}else c=c<=0?a.length-1:c-1;v()}}function ee(){if(a.length===0)return;const e=c-1;c=e<0?a.length-1:e,v()}function te(){if(a.length===0)return;const e=c+1;c=e>=a.length?0:e,v()}function ne(){const e=i.clientWidth-24;return Math.max(1,Math.floor(e/(200+10)))}function se(){if(a.length===0)return;const e=a[c];if(e){if(e.isWebSearch){e.searchQuery&&e.url&&(chrome.tabs.create({url:e.url}),window.close());return}if(e.sessionId){Q(e.sessionId);return}e.id>0&&G(e.id)}}async function G(e){try{await chrome.tabs.update(e,{active:!0});const t=await chrome.tabs.get(e);t.windowId&&await chrome.windows.update(t.windowId,{focused:!0}),window.close()}catch(t){console.error("[SWITCHER POPUP] Failed to switch tab:",t)}}function K(){l!=="active"&&(l="active",u=!1,o=[...$],a=[...o],c=0,i.classList.remove("recent-mode"),i.classList.remove("search-mode"),D.classList.remove("shrink-mode"),E.textContent="Opened Tabs",r.value="",d="",A.classList.remove("hidden"),x(),v(),T(),r.focus())}async function ae(){if(l!=="recent"){l="recent",u=!1;try{const e=await chrome.runtime.sendMessage({action:"getRecentlyClosed",maxResults:10});e?.success&&e.items?(o=e.items.map((n,f)=>({id:-1,title:n.title||"Untitled",url:n.url||"",favIconUrl:n.favIconUrl||"",screenshot:null,pinned:!1,index:f,active:!1,sessionId:n.sessionId})),a=[...o]):(o=[],a=[])}catch(e){console.error("[SWITCHER POPUP] Failed to load recently closed:",e),o=[],a=[]}c=0,i.classList.add("recent-mode"),i.classList.remove("search-mode"),E.textContent="Recently Closed",r.value="",d="",A.classList.add("hidden"),x(),v(),T(),r.focus()}}async function Q(e){try{await chrome.runtime.sendMessage({action:"restoreSession",sessionId:e}),window.close()}catch(t){console.error("[SWITCHER POPUP] Failed to restore session:",t)}}function T(){M&&(l==="recent"?M.innerHTML=`
      <span><kbd>‚Üë‚Üì</kbd> Navigate</span>
      <span><kbd>‚Üµ</kbd>Restore</span>
      <span><kbd>.</kbd> <kbd>Backspace</kbd> Active Tabs</span>
      <span><kbd>Esc</kbd>Exit</span>
    `:u?M.innerHTML=`
      <span><kbd>Tab</kbd>Exit Search Mode</span>
      <span><kbd>‚Üµ</kbd>Search Google</span>
      <span><kbd>Backspace</kbd>Exit</span>
      <span><kbd>Esc</kbd>Exit</span>
    `:M.innerHTML=`
      <span><kbd>Alt+Q</kbd> <kbd>‚Üë‚Üì</kbd> Navigate</span>
      <span><kbd>‚Üµ</kbd>Switch</span>
      <span><kbd>Del</kbd>Close</span>
      <span><kbd>.</kbd>Recent</span>
      <span><kbd>Tab</kbd>Web Search</span>
      <span><kbd>Esc</kbd>Exit</span>
    `)}async function Z(e){try{await chrome.tabs.remove(e),o=o.filter(t=>t.id!==e),a=a.filter(t=>t.id!==e),c>=a.length&&(c=Math.max(0,a.length-1)),x(),v(),a.length===0&&window.close()}catch(t){console.error("[SWITCHER POPUP] Failed to close tab:",t)}}function ce(){if(a.length===0)return;const e=a[c];e&&Z(e.id)}function V(e){I=e,H.classList.toggle("active",e==="grid"),q.classList.toggle("active",e==="list"),i.classList.toggle("list-view",e==="list");try{chrome.storage.local.set({tabSwitcherViewMode:e})}catch{}v()}function v(){i.querySelectorAll(".tab-card.selected").forEach(t=>{t.classList.remove("selected")});const e=i.querySelectorAll(".tab-card");e[c]&&(e[c].classList.add("selected"),e[c].scrollIntoView({block:"nearest",behavior:"smooth"}))}function x(){if(i.innerHTML="",i.classList.toggle("list-view",I==="list"),a.length===0){const e=l==="recent"?"No recently closed tabs":u?"Type to search the web...":"No tabs found";i.innerHTML=`
      <div class="tab-switcher-empty">
        <div class="empty-icon">${l==="recent"?"üìã":u?"üåê":"üîç"}</div>
        <div>${e}</div>
      </div>
    `;return}a.forEach((e,t)=>{const n=oe(e,t);i.appendChild(n)})}function oe(e,t){const n=document.createElement("div");if(e.isWebSearch){n.className="tab-card web-search-card",n.dataset.index=String(t);const s=document.createElement("div");s.className="tab-thumbnail";const h=document.createElement("div");h.className="favicon-tile";const g=document.createElement("img");g.className="favicon-large",g.src="https://www.google.com/favicon.ico",g.alt="Google",g.onerror=()=>{h.innerHTML='<div class="favicon-letter">G</div>'},h.appendChild(g),s.appendChild(h),n.appendChild(s);const w=document.createElement("div");w.className="tab-info";const b=document.createElement("div");b.className="tab-title-row";const y=document.createElement("img");y.className="tab-favicon",y.src="https://www.google.com/favicon.ico",y.alt="",b.appendChild(y);const p=document.createElement("span");p.className="tab-title",p.textContent=e.title,b.appendChild(p),w.appendChild(b);const C=document.createElement("div");return C.className="tab-url",C.textContent=e.searchQuery?"Press Enter to search Google":"Type your search query...",w.appendChild(C),n.appendChild(w),n}if(e.sessionId){n.className="tab-card recent-item",n.dataset.sessionId=e.sessionId,n.dataset.index=String(t);const s=document.createElement("div");if(s.className="tab-thumbnail",e.favIconUrl){const p=document.createElement("div");p.className="favicon-tile";const C=document.createElement("img");C.className="favicon-large",C.src=e.favIconUrl,C.alt="",C.onerror=()=>{p.innerHTML=`<div class="favicon-letter">${R(e.title)}</div>`},p.appendChild(C),s.appendChild(p)}else s.innerHTML=`<div class="favicon-tile"><div class="favicon-letter">${R(e.title)}</div></div>`;n.appendChild(s);const h=document.createElement("div");h.className="tab-info";const g=document.createElement("div");if(g.className="tab-title-row",e.favIconUrl){const p=document.createElement("img");p.className="tab-favicon",p.src=e.favIconUrl,p.alt="",p.onerror=()=>p.remove(),g.appendChild(p)}const w=document.createElement("span");w.className="tab-title",w.textContent=e.title||"Untitled",w.title=e.title||"Untitled",g.appendChild(w),h.appendChild(g);const b=document.createElement("div");b.className="tab-url",b.textContent=F(e.url),b.title=e.url||"",h.appendChild(b),n.appendChild(h);const y=document.createElement("button");return y.className="tab-close-btn restore-btn",y.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
      <path d="M3 3v5h5"/>
    </svg>`,y.title="Restore tab",n.appendChild(y),n}n.className=`tab-card${e.pinned?" pinned":""}${e.active?" active-tab":""}`,n.dataset.tabId=String(e.id),n.dataset.index=String(t);const f=e.groupId&&e.groupId!==-1?z.find(s=>s.id===e.groupId):null;f&&(n.dataset.groupId=String(f.id),n.style.setProperty("--group-color",re(f.color)));const m=document.createElement("div");if(m.className="tab-thumbnail",e.screenshot){const s=document.createElement("img");s.className="screenshot-img",s.src=e.screenshot,s.alt="",s.loading="lazy",m.appendChild(s)}else{const s=document.createElement("div");if(s.className="favicon-tile",e.favIconUrl&&!e.favIconUrl.startsWith("chrome://")){const h=document.createElement("img");h.className="favicon-large",h.src=e.favIconUrl,h.alt="",h.onerror=()=>{s.innerHTML=`<div class="favicon-letter">${R(e.title)}</div>`},s.appendChild(h)}else s.innerHTML=`<div class="favicon-letter">${R(e.title)}</div>`;m.appendChild(s)}n.appendChild(m);const k=document.createElement("div");k.className="tab-info";const S=document.createElement("div");if(S.className="tab-title-row",e.favIconUrl&&!e.favIconUrl.startsWith("chrome://")){const s=document.createElement("img");s.className="tab-favicon",s.src=e.favIconUrl,s.alt="",s.onerror=()=>s.remove(),S.appendChild(s)}const U=document.createElement("span");U.className="tab-title",U.textContent=e.title||"Untitled",U.title=e.title||"Untitled",S.appendChild(U),k.appendChild(S);const N=document.createElement("div");N.className="tab-url",N.textContent=F(e.url),N.title=e.url||"",k.appendChild(N),n.appendChild(k);const P=document.createElement("button");if(P.className="tab-close-btn",P.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <line x1="18" y1="6" x2="6" y2="18"></line>
    <line x1="6" y1="6" x2="18" y2="18"></line>
  </svg>`,P.title="Close tab",n.appendChild(P),e.audible&&!e.mutedInfo?.muted){const s=document.createElement("div");s.className="tab-audio-indicator",s.innerHTML='<svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg>',n.appendChild(s)}else if(e.mutedInfo?.muted){const s=document.createElement("div");s.className="tab-audio-indicator muted",s.innerHTML='<svg viewBox="0 0 24 24"><path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/></svg>',n.appendChild(s)}return n}function R(e){return(e.replace(/[^a-zA-Z0-9]/g,"")[0]||"T").toUpperCase()}function F(e){if(!e)return"";try{return new URL(e).hostname.replace(/^www\./,"")}catch{return e.slice(0,50)}}function re(e){const t={grey:"#5f6368",blue:"#1a73e8",red:"#d93025",yellow:"#f9ab00",green:"#1e8e3e",pink:"#d01884",purple:"#9334e6",cyan:"#007b83",orange:"#e8710a"};return t[e]||t.grey}document.addEventListener("DOMContentLoaded",_);
